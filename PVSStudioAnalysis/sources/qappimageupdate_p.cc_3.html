
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>qappimageupdate_p.cc</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2"> * BSD 3-Clause License</a>
<a name="ln3"> *</a>
<a name="ln4"> * Copyright (c) 2018-2019, Antony jr</a>
<a name="ln5"> * All rights reserved.</a>
<a name="ln6"> *</a>
<a name="ln7"> * Redistribution and use in source and binary forms, with or without</a>
<a name="ln8"> * modification, are permitted provided that the following conditions are met:</a>
<a name="ln9"> *</a>
<a name="ln10"> * * Redistributions of source code must retain the above copyright notice, this</a>
<a name="ln11"> *   list of conditions and the following disclaimer.</a>
<a name="ln12"> *</a>
<a name="ln13"> * * Redistributions in binary form must reproduce the above copyright notice,</a>
<a name="ln14"> *   this list of conditions and the following disclaimer in the documentation</a>
<a name="ln15"> *   and/or other materials provided with the distribution.</a>
<a name="ln16"> *</a>
<a name="ln17"> * * Neither the name of the copyright holder nor the names of its</a>
<a name="ln18"> *   contributors may be used to endorse or promote products derived from</a>
<a name="ln19"> *   this software without specific prior written permission.</a>
<a name="ln20"> *</a>
<a name="ln21"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</a>
<a name="ln22"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</a>
<a name="ln23"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</a>
<a name="ln24"> * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE</a>
<a name="ln25"> * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</a>
<a name="ln26"> * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</a>
<a name="ln27"> * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</a>
<a name="ln28"> * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</a>
<a name="ln29"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</a>
<a name="ln30"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</a>
<a name="ln31"> *</a>
<a name="ln32">*/</a>
<a name="ln33"> </a>
<a name="ln34">#include &lt;QCoreApplication&gt;</a>
<a name="ln35"> </a>
<a name="ln36">#include &quot;qappimageupdate_p.hpp&quot;</a>
<a name="ln37">#include &quot;helpers_p.hpp&quot;</a>
<a name="ln38"> </a>
<a name="ln39">#ifndef NO_GUI</a>
<a name="ln40">#include &lt;QApplication&gt;</a>
<a name="ln41">#include &lt;QMessageBox&gt;</a>
<a name="ln42">#include &lt;QProcess&gt;</a>
<a name="ln43">#include &lt;QScreen&gt;</a>
<a name="ln44">#include &lt;QPixmap&gt;</a>
<a name="ln45"> </a>
<a name="ln46">#include &quot;softwareupdatedialog_p.hpp&quot;</a>
<a name="ln47">#include &lt;ui_AppImageUpdaterDialog.h&gt;</a>
<a name="ln48">#endif // NOT NO_GUI</a>
<a name="ln49"> </a>
<a name="ln50"> </a>
<a name="ln51">QAppImageUpdatePrivate::QAppImageUpdatePrivate(bool singleThreaded, QObject *parent)</a>
<a name="ln52">    : QObject(parent) {</a>
<a name="ln53">    setObjectName(&quot;QAppImageUpdatePrivate&quot;);</a>
<a name="ln54">    if(!singleThreaded) {</a>
<a name="ln55">        m_SharedThread.reset(new QThread);</a>
<a name="ln56">        m_SharedThread-&gt;start();</a>
<a name="ln57">    }</a>
<a name="ln58"> </a>
<a name="ln59"> </a>
<a name="ln60">    m_SharedNetworkAccessManager.reset(new QNetworkAccessManager);</a>
<a name="ln61">    m_UpdateInformation.reset(new AppImageUpdateInformationPrivate);</a>
<a name="ln62">    m_DeltaWriter.reset(new ZsyncWriterPrivate(m_SharedNetworkAccessManager.data()));</a>
<a name="ln63">#ifdef DECENTRALIZED_UPDATE_ENABLED</a>
<a name="ln64">    m_Seeder.reset(new Seeder(m_SharedNetworkAccessManager.data()));</a>
<a name="ln65">#endif</a>
<a name="ln66"> </a>
<a name="ln67">    if(!singleThreaded) {</a>
<a name="ln68">        m_SharedNetworkAccessManager-&gt;moveToThread(m_SharedThread.data());</a>
<a name="ln69">        m_UpdateInformation-&gt;moveToThread(m_SharedThread.data());</a>
<a name="ln70">        m_DeltaWriter-&gt;moveToThread(m_SharedThread.data());</a>
<a name="ln71">    }</a>
<a name="ln72">    m_ControlFileParser.reset(new ZsyncRemoteControlFileParserPrivate(m_SharedNetworkAccessManager.data()));</a>
<a name="ln73">    if(!singleThreaded) {</a>
<a name="ln74">        m_ControlFileParser-&gt;moveToThread(m_SharedThread.data());</a>
<a name="ln75">    }</a>
<a name="ln76">    m_ControlFileParser-&gt;setObjectName(&quot;ZsyncRemoteControlFileParserPrivate&quot;);</a>
<a name="ln77">    m_UpdateInformation-&gt;setObjectName(&quot;AppImageUpdateInformationPrivate&quot;);</a>
<a name="ln78">    m_DeltaWriter-&gt;setObjectName(&quot;ZsyncWriterPrivate&quot;);</a>
<a name="ln79"> </a>
<a name="ln80">    // Set logger name</a>
<a name="ln81">    m_UpdateInformation-&gt;setLoggerName(&quot;UpdateInformation&quot;);</a>
<a name="ln82">    m_ControlFileParser-&gt;setLoggerName(&quot;ControlFileParser&quot;);</a>
<a name="ln83">    m_DeltaWriter-&gt;setLoggerName(&quot;DeltaWriter&quot;);</a>
<a name="ln84"> </a>
<a name="ln85"> </a>
<a name="ln86">    // Update information</a>
<a name="ln87">    connect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::logger,</a>
<a name="ln88">            this, &amp;QAppImageUpdatePrivate::logger,</a>
<a name="ln89">            (Qt::ConnectionType)(Qt::DirectConnection | Qt::UniqueConnection));</a>
<a name="ln90">    connect(m_UpdateInformation.data(), SIGNAL(operatingAppImagePath(QString)),</a>
<a name="ln91">            this, SLOT(setCurrentAppImagePath(QString)),</a>
<a name="ln92">            Qt::QueuedConnection);</a>
<a name="ln93"> </a>
<a name="ln94"> </a>
<a name="ln95">    // Control file parsing</a>
<a name="ln96">    connect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::logger,</a>
<a name="ln97">            this, &amp;QAppImageUpdatePrivate::logger,</a>
<a name="ln98">            (Qt::ConnectionType)(Qt::DirectConnection | Qt::UniqueConnection));</a>
<a name="ln99"> </a>
<a name="ln100">    // Delta Writer and Downloader</a>
<a name="ln101">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::logger,</a>
<a name="ln102">            this, &amp;QAppImageUpdatePrivate::logger,</a>
<a name="ln103">            (Qt::ConnectionType)(Qt::DirectConnection | Qt::UniqueConnection));</a>
<a name="ln104">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::started,</a>
<a name="ln105">            this, &amp;QAppImageUpdatePrivate::handleUpdateStart,</a>
<a name="ln106">   	    (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln107"> </a>
<a name="ln108">    // Torrent Seeder</a>
<a name="ln109">#ifdef DECENTRALIZED_UPDATE_ENABLED </a>
<a name="ln110">    connect(m_Seeder.data(), &amp;Seeder::started,</a>
<a name="ln111">            this, &amp;QAppImageUpdatePrivate::torrentClientStarted ,</a>
<a name="ln112">            (Qt::ConnectionType)(Qt::DirectConnection | Qt::UniqueConnection));</a>
<a name="ln113">    connect(m_Seeder.data(), &amp;Seeder::torrentStatus,</a>
<a name="ln114">            this, &amp;QAppImageUpdatePrivate::torrentStatus,</a>
<a name="ln115">            (Qt::ConnectionType)(Qt::DirectConnection | Qt::UniqueConnection));</a>
<a name="ln116">#endif</a>
<a name="ln117"> </a>
<a name="ln118">    // Torrent Downloader Specific</a>
<a name="ln119">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::torrentClientStarted,</a>
<a name="ln120">            this, &amp;QAppImageUpdatePrivate::torrentClientStarted ,</a>
<a name="ln121">            (Qt::ConnectionType)(Qt::DirectConnection | Qt::UniqueConnection));</a>
<a name="ln122">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::torrentStatus,</a>
<a name="ln123">            this, &amp;QAppImageUpdatePrivate::torrentStatus,</a>
<a name="ln124">            (Qt::ConnectionType)(Qt::DirectConnection | Qt::UniqueConnection));</a>
<a name="ln125">}</a>
<a name="ln126"> </a>
<a name="ln127">QAppImageUpdatePrivate::QAppImageUpdatePrivate(const QString &amp;AppImagePath, bool singleThreaded, QObject *parent)</a>
<a name="ln128">    : QAppImageUpdatePrivate(singleThreaded, parent) {</a>
<a name="ln129">    setAppImage(AppImagePath);</a>
<a name="ln130">    return;</a>
<a name="ln131">}</a>
<a name="ln132"> </a>
<a name="ln133">QAppImageUpdatePrivate::QAppImageUpdatePrivate(QFile *AppImage, bool singleThreaded, QObject *parent)</a>
<a name="ln134">    : QAppImageUpdatePrivate(singleThreaded, parent) {</a>
<a name="ln135">    setAppImage(AppImage);</a>
<a name="ln136">    return;</a>
<a name="ln137">}</a>
<a name="ln138"> </a>
<a name="ln139">QAppImageUpdatePrivate::~QAppImageUpdatePrivate() {</a>
<a name="ln140">    if(b_Started || b_Running) {</a>
<a name="ln141">        cancel();</a>
<a name="ln142">    }</a>
<a name="ln143"> </a>
<a name="ln144">    if(!m_SharedThread.isNull()) {</a>
<a name="ln145">        m_SharedThread-&gt;quit();</a>
<a name="ln146">        m_SharedThread-&gt;wait();</a>
<a name="ln147">    }</a>
<a name="ln148">    return;</a>
<a name="ln149">}</a>
<a name="ln150"> </a>
<a name="ln151">void QAppImageUpdatePrivate::setApplicationName(const QString &amp;applicationName) {</a>
<a name="ln152">    if(b_Started || b_Running) {</a>
<a name="ln153">        return;</a>
<a name="ln154">    }</a>
<a name="ln155">    m_ApplicationName = applicationName;</a>
<a name="ln156">}</a>
<a name="ln157"> </a>
<a name="ln158">void QAppImageUpdatePrivate::setIcon(QByteArray icon) {</a>
<a name="ln159">    if(b_Started || b_Running) {</a>
<a name="ln160">        return;</a>
<a name="ln161">    }</a>
<a name="ln162"> </a>
<a name="ln163">    m_Icon = icon;</a>
<a name="ln164">}</a>
<a name="ln165"> </a>
<a name="ln166">void QAppImageUpdatePrivate::setGuiFlag(int flag) {</a>
<a name="ln167">    if(b_Started || b_Running) {</a>
<a name="ln168">        return;</a>
<a name="ln169">    }</a>
<a name="ln170"> </a>
<a name="ln171">    n_GuiFlag = flag;</a>
<a name="ln172">}</a>
<a name="ln173"> </a>
<a name="ln174">void QAppImageUpdatePrivate::setAppImage(const QString &amp;AppImagePath) {</a>
<a name="ln175">    if(b_Started || b_Running) {</a>
<a name="ln176">        return;</a>
<a name="ln177">    }</a>
<a name="ln178"> </a>
<a name="ln179">    clear();</a>
<a name="ln180">    getMethod(m_UpdateInformation.data(), &quot;setAppImage(const QString&amp;)&quot;)</a>
<a name="ln181">    .invoke(m_UpdateInformation.data(),</a>
<a name="ln182">            Qt::QueuedConnection,</a>
<a name="ln183">            Q_ARG(QString,AppImagePath));</a>
<a name="ln184">    return;</a>
<a name="ln185">}</a>
<a name="ln186"> </a>
<a name="ln187">void QAppImageUpdatePrivate::setAppImage(QFile *AppImage) {</a>
<a name="ln188">    if(b_Started || b_Running) {</a>
<a name="ln189">        return;</a>
<a name="ln190">    }</a>
<a name="ln191"> </a>
<a name="ln192">    clear();</a>
<a name="ln193">    getMethod(m_UpdateInformation.data(), &quot;setAppImage(QFile *)&quot;)</a>
<a name="ln194">    .invoke(m_UpdateInformation.data(),</a>
<a name="ln195">            Qt::QueuedConnection,</a>
<a name="ln196">            Q_ARG(QFile*,AppImage));</a>
<a name="ln197">}</a>
<a name="ln198"> </a>
<a name="ln199">void QAppImageUpdatePrivate::setShowLog(bool choice) {</a>
<a name="ln200">    if(b_Started || b_Running) {</a>
<a name="ln201">        return;</a>
<a name="ln202">    }</a>
<a name="ln203"> </a>
<a name="ln204">    getMethod(m_UpdateInformation.data(), &quot;setShowLog(bool)&quot;)</a>
<a name="ln205">    .invoke(m_UpdateInformation.data(),</a>
<a name="ln206">            Qt::QueuedConnection,</a>
<a name="ln207">            Q_ARG(bool, choice));</a>
<a name="ln208"> </a>
<a name="ln209">    getMethod(m_ControlFileParser.data(), &quot;setShowLog(bool)&quot;)</a>
<a name="ln210">    .invoke(m_ControlFileParser.data(),</a>
<a name="ln211">            Qt::QueuedConnection,</a>
<a name="ln212">            Q_ARG(bool, choice));</a>
<a name="ln213"> </a>
<a name="ln214">    getMethod(m_DeltaWriter.data(), &quot;setShowLog(bool)&quot;)</a>
<a name="ln215">    .invoke(m_DeltaWriter.data(),</a>
<a name="ln216">            Qt::QueuedConnection,</a>
<a name="ln217">            Q_ARG(bool, choice));</a>
<a name="ln218">}</a>
<a name="ln219"> </a>
<a name="ln220">void QAppImageUpdatePrivate::setOutputDirectory(const QString &amp;dir) {</a>
<a name="ln221">    if(b_Started || b_Running) {</a>
<a name="ln222">        return;</a>
<a name="ln223">    }</a>
<a name="ln224"> </a>
<a name="ln225">    getMethod(m_DeltaWriter.data(), &quot;setOutputDirectory(const QString&amp;)&quot;)</a>
<a name="ln226">    .invoke(m_DeltaWriter.data(),</a>
<a name="ln227">            Qt::QueuedConnection,</a>
<a name="ln228">            Q_ARG(QString, dir));</a>
<a name="ln229">    return;</a>
<a name="ln230">}</a>
<a name="ln231"> </a>
<a name="ln232">void QAppImageUpdatePrivate::setProxy(const QNetworkProxy &amp;proxy) {</a>
<a name="ln233">    if(b_Started || b_Running) {</a>
<a name="ln234">        return;</a>
<a name="ln235">    }</a>
<a name="ln236">    m_SharedNetworkAccessManager-&gt;setProxy(proxy);</a>
<a name="ln237">    return;</a>
<a name="ln238">}</a>
<a name="ln239"> </a>
<a name="ln240">void QAppImageUpdatePrivate::clear(void) {</a>
<a name="ln241">    if(b_Started || b_Running) {</a>
<a name="ln242">        return;</a>
<a name="ln243">    }</a>
<a name="ln244"> </a>
<a name="ln245">    b_Started = b_Running = b_Finished = b_Canceled = b_CancelRequested = false;</a>
<a name="ln246">    getMethod(m_UpdateInformation.data(), &quot;clear(void)&quot;)</a>
<a name="ln247">    .invoke(m_UpdateInformation.data(), Qt::QueuedConnection);</a>
<a name="ln248">    getMethod(m_ControlFileParser.data(), &quot;clear(void)&quot;)</a>
<a name="ln249">    .invoke(m_ControlFileParser.data(), Qt::QueuedConnection);</a>
<a name="ln250">    return;</a>
<a name="ln251">}</a>
<a name="ln252"> </a>
<a name="ln253"> </a>
<a name="ln254">void QAppImageUpdatePrivate::start(short action, int flags, QByteArray icon) {</a>
<a name="ln255">    if(b_Started || b_Running) {</a>
<a name="ln256">        return;</a>
<a name="ln257">    }</a>
<a name="ln258"> </a>
<a name="ln259">    b_Started = b_Running = true;</a>
<a name="ln260">    b_Canceled = false;</a>
<a name="ln261">    b_Finished = false;</a>
<a name="ln262"> </a>
<a name="ln263">    if(b_CancelRequested) {</a>
<a name="ln264">        b_Started = b_Running = false;</a>
<a name="ln265">        b_Canceled = true;</a>
<a name="ln266">        b_CancelRequested = false;</a>
<a name="ln267">        emit canceled(action);</a>
<a name="ln268">        return;</a>
<a name="ln269">    }</a>
<a name="ln270"> </a>
<a name="ln271">    if(flags == GuiFlag::None) {</a>
<a name="ln272">        flags = (n_GuiFlag != GuiFlag::None) ? n_GuiFlag : GuiFlag::Default;</a>
<a name="ln273">    }</a>
<a name="ln274">    n_GuiFlag = flags;</a>
<a name="ln275"> </a>
<a name="ln276">    if(icon.isEmpty() &amp;&amp; !m_Icon.isEmpty()) {</a>
<a name="ln277">        icon = m_Icon;</a>
<a name="ln278">    }</a>
<a name="ln279"> </a>
<a name="ln280">    if(action == Action::GetEmbeddedInfo) {</a>
<a name="ln281">        n_CurrentAction = action;</a>
<a name="ln282">        connect(m_UpdateInformation.data(),  &amp;AppImageUpdateInformationPrivate::info,</a>
<a name="ln283">                this, &amp;QAppImageUpdatePrivate::redirectEmbeddedInformation,</a>
<a name="ln284">                Qt::QueuedConnection);</a>
<a name="ln285">        connect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::progress,</a>
<a name="ln286">                this, &amp;QAppImageUpdatePrivate::handleGetEmbeddedInfoProgress);</a>
<a name="ln287">        connect(m_UpdateInformation.data(),  &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln288">                this, &amp;QAppImageUpdatePrivate::handleGetEmbeddedInfoError,</a>
<a name="ln289">                Qt::QueuedConnection);</a>
<a name="ln290"> </a>
<a name="ln291">        emit started(Action::GetEmbeddedInfo);</a>
<a name="ln292">        getMethod(m_UpdateInformation.data(), &quot;getInfo(void)&quot;)</a>
<a name="ln293">        .invoke(m_UpdateInformation.data(), Qt::QueuedConnection);</a>
<a name="ln294"> </a>
<a name="ln295">    } else if(action == Action::CheckForUpdate) {</a>
<a name="ln296">        n_CurrentAction = action;</a>
<a name="ln297"> </a>
<a name="ln298">        //// Needed to check if Bittorrent file is</a>
<a name="ln299">        //// supported.</a>
<a name="ln300">#ifdef DECENTRALIZED_UPDATE_ENABLED</a>
<a name="ln301">        m_ControlFileParser-&gt;setUseBittorrent(true);</a>
<a name="ln302">#else</a>
<a name="ln303">        m_ControlFileParser-&gt;setUseBittorrent(false);</a>
<a name="ln304">#endif</a>
<a name="ln305">        connect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln306">                m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)),</a>
<a name="ln307">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln308"> </a>
<a name="ln309">        connect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln310">                m_ControlFileParser.data(), SLOT(getUpdateCheckInformation(void)),</a>
<a name="ln311">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln312"> </a>
<a name="ln313">        connect(m_ControlFileParser.data(), SIGNAL(updateCheckInformation(QJsonObject)),</a>
<a name="ln314">                this, SLOT(redirectUpdateCheck(QJsonObject)),</a>
<a name="ln315">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln316"> </a>
<a name="ln317">        connect(m_ControlFileParser.data(), SIGNAL(progress(int)),</a>
<a name="ln318">                this, SLOT(handleCheckForUpdateProgress(int)));</a>
<a name="ln319"> </a>
<a name="ln320">        connect(m_ControlFileParser.data(), SIGNAL(error(short)),</a>
<a name="ln321">                this, SLOT(handleCheckForUpdateError(short)),</a>
<a name="ln322">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln323"> </a>
<a name="ln324">        connect(m_UpdateInformation.data(), SIGNAL(error(short)),</a>
<a name="ln325">                this, SLOT(handleCheckForUpdateError(short)),</a>
<a name="ln326">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln327"> </a>
<a name="ln328"> </a>
<a name="ln329">        emit started(Action::CheckForUpdate);</a>
<a name="ln330">        getMethod(m_UpdateInformation.data(), &quot;getInfo(void)&quot;)</a>
<a name="ln331">        .invoke(m_UpdateInformation.data(), Qt::QueuedConnection);</a>
<a name="ln332">    } else if(action == Action::Update || action == Action::UpdateWithTorrent) {</a>
<a name="ln333">        n_CurrentAction = action;</a>
<a name="ln334"> </a>
<a name="ln335">        //// With respect to GDPR, It is strongly adviced</a>
<a name="ln336">        //// to use Torrent only if the user explicitly</a>
<a name="ln337">        //// asks for it.</a>
<a name="ln338">#ifdef DECENTRALIZED_UPDATE_ENABLED</a>
<a name="ln339">        m_ControlFileParser-&gt;setUseBittorrent((action == Action::UpdateWithTorrent));</a>
<a name="ln340">#else</a>
<a name="ln341">        m_ControlFileParser-&gt;setUseBittorrent(false);</a>
<a name="ln342">#endif</a>
<a name="ln343">        connect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln344">                m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)),</a>
<a name="ln345">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln346"> </a>
<a name="ln347">        connect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln348">                m_ControlFileParser.data(), SLOT(getZsyncInformation(void)),</a>
<a name="ln349">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln350"> </a>
<a name="ln351">        connect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln352">                m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration,</a>
<a name="ln353">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln354"> </a>
<a name="ln355">        connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln356">                m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start,</a>
<a name="ln357">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln358"> </a>
<a name="ln359">        connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln360">                this, &amp;QAppImageUpdatePrivate::handleUpdateFinished,</a>
<a name="ln361">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln362"> </a>
<a name="ln363">        connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln364">                this, &amp;QAppImageUpdatePrivate::handleUpdateError,</a>
<a name="ln365">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln366"> </a>
<a name="ln367">        connect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln368">                this, &amp;QAppImageUpdatePrivate::handleUpdateError,</a>
<a name="ln369">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln370"> </a>
<a name="ln371">        connect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln372">                this, &amp;QAppImageUpdatePrivate::handleUpdateError,</a>
<a name="ln373">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln374"> </a>
<a name="ln375">        connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln376">                this, &amp;QAppImageUpdatePrivate::handleUpdateProgress,</a>
<a name="ln377">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln378"> </a>
<a name="ln379">        connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln380">                this, &amp;QAppImageUpdatePrivate::handleUpdateCancel,</a>
<a name="ln381">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln382"> </a>
<a name="ln383">        //// Started signal will be emitted by handleUpdateStart</a>
<a name="ln384">        //// which is connected at the construction.</a>
<a name="ln385">        getMethod(m_UpdateInformation.data(), &quot;getInfo(void)&quot;)</a>
<a name="ln386">        .invoke(m_UpdateInformation.data(), Qt::QueuedConnection);</a>
<a name="ln387"> </a>
<a name="ln388">    } else if(action == Action::UpdateWithGUI || action == Action::UpdateWithGUIAndTorrent) {</a>
<a name="ln389">#ifdef NO_GUI</a>
<a name="ln390">        b_Started = b_CancelRequested = b_Finished = b_Canceled = false;</a>
<a name="ln391">        emit error(QAppImageUpdateEnums::Error::UnsupportedActionForBuild, action);</a>
<a name="ln392">        return;</a>
<a name="ln393">#else</a>
<a name="ln394">        n_CurrentAction = action;</a>
<a name="ln395"> </a>
<a name="ln396">        if(m_ApplicationName.isEmpty()) {</a>
<a name="ln397">            m_ApplicationName = QCoreApplication::applicationName();</a>
<a name="ln398">        }</a>
<a name="ln399"> </a>
<a name="ln400">        // Setup GUI if not constructed before</a>
<a name="ln401">        if(!b_GuiClassesConstructed) {</a>
<a name="ln402">            m_UpdaterDialog.reset(new QDialog);</a>
<a name="ln403">            m_UpdaterDialog-&gt;setObjectName(QString::fromUtf8(&quot;AppImageUpdaterDialog&quot;));</a>
<a name="ln404"> </a>
<a name="ln405">            m_Ui = QSharedPointer&lt;Ui::AppImageUpdaterDialog&gt;(new Ui::AppImageUpdaterDialog);</a>
<a name="ln406">            m_Ui-&gt;setupUi(m_UpdaterDialog.data());</a>
<a name="ln407"> </a>
<a name="ln408">            /*</a>
<a name="ln409">             * Default program logic.</a>
<a name="ln410">             */</a>
<a name="ln411"> </a>
<a name="ln412">            connect((m_Ui-&gt;updateCancelBtn), &amp;QPushButton::clicked, this, &amp;QAppImageUpdatePrivate::cancel, Qt::QueuedConnection);</a>
<a name="ln413">            connect(m_UpdaterDialog.data(), &amp;QDialog::rejected, this, &amp;QAppImageUpdatePrivate::cancel, Qt::QueuedConnection);</a>
<a name="ln414"> </a>
<a name="ln415">            b_GuiClassesConstructed = true;</a>
<a name="ln416">        }</a>
<a name="ln417"> </a>
<a name="ln418">        QPixmap icon;</a>
<a name="ln419"> </a>
<a name="ln420">        if(!m_Icon.isEmpty()) {</a>
<a name="ln421">            icon.loadFromData(m_Icon);</a>
<a name="ln422">        }</a>
<a name="ln423"> </a>
<a name="ln424">        /* Set AppImage icon if given. */</a>
<a name="ln425">        if(!icon.isNull()) {</a>
<a name="ln426">            (m_Ui-&gt;softwareIcon)-&gt;setPixmap(icon);</a>
<a name="ln427">            (m_Ui-&gt;softwareIconOnUpdating)-&gt;setPixmap(icon);</a>
<a name="ln428">            m_UpdaterDialog-&gt;setWindowIcon(icon);</a>
<a name="ln429">        } else {</a>
<a name="ln430">            bool found = false;</a>
<a name="ln431">            if(QApplication::windowIcon().isNull()) {</a>
<a name="ln432">                foreach (QWidget *widget, QApplication::allWidgets()) {</a>
<a name="ln433">                    if(!((widget-&gt;windowIcon()).isNull())) {</a>
<a name="ln434">                        icon = widget-&gt;windowIcon().pixmap(100, 100);</a>
<a name="ln435">                        (m_Ui-&gt;softwareIcon)-&gt;setPixmap(icon);</a>
<a name="ln436">                        (m_Ui-&gt;softwareIconOnUpdating)-&gt;setPixmap(icon);</a>
<a name="ln437">                        m_UpdaterDialog-&gt;setWindowIcon(icon);</a>
<a name="ln438">                        found = true;</a>
<a name="ln439">                        break;</a>
<a name="ln440">                    }</a>
<a name="ln441">                    QCoreApplication::processEvents();</a>
<a name="ln442">                }</a>
<a name="ln443">            } else {</a>
<a name="ln444">                icon = QApplication::windowIcon().pixmap(100, 100);</a>
<a name="ln445">                found = true;</a>
<a name="ln446">            }</a>
<a name="ln447"> </a>
<a name="ln448">            if(!found) {</a>
<a name="ln449">                (m_Ui-&gt;softwareIcon)-&gt;setVisible(false);</a>
<a name="ln450">                (m_Ui-&gt;softwareIconOnUpdating)-&gt;setVisible(false);</a>
<a name="ln451">            }</a>
<a name="ln452">        }</a>
<a name="ln453"> </a>
<a name="ln454"> </a>
<a name="ln455"> </a>
<a name="ln456">        m_ConfirmationDialog = QSharedPointer&lt;SoftwareUpdateDialog&gt;(new SoftwareUpdateDialog(nullptr, icon, n_GuiFlag));</a>
<a name="ln457"> </a>
<a name="ln458">#ifdef DECENTRALIZED_UPDATE_ENABLED</a>
<a name="ln459">        m_ControlFileParser-&gt;setUseBittorrent((action == Action::UpdateWithGUIAndTorrent));</a>
<a name="ln460">#else</a>
<a name="ln461">        m_ControlFileParser-&gt;setUseBittorrent(false);</a>
<a name="ln462">#endif</a>
<a name="ln463"> </a>
<a name="ln464">        connect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln465">                m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)),</a>
<a name="ln466">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln467"> </a>
<a name="ln468">        connect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln469">                m_ControlFileParser.data(), SLOT(getUpdateCheckInformation(void)),</a>
<a name="ln470">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln471"> </a>
<a name="ln472">        connect(m_ControlFileParser.data(), SIGNAL(updateCheckInformation(QJsonObject)),</a>
<a name="ln473">                this, SLOT(handleGUIUpdateCheck(QJsonObject)),</a>
<a name="ln474">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln475"> </a>
<a name="ln476">        connect(m_ControlFileParser.data(), SIGNAL(progress(int)),</a>
<a name="ln477">                this, SLOT(handleGUIUpdateCheckProgress(int)),</a>
<a name="ln478">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln479"> </a>
<a name="ln480">        connect(m_ControlFileParser.data(), SIGNAL(error(short)),</a>
<a name="ln481">                this, SLOT(handleGUIUpdateCheckError(short)),</a>
<a name="ln482">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln483"> </a>
<a name="ln484">        connect(m_UpdateInformation.data(), SIGNAL(error(short)),</a>
<a name="ln485">                this, SLOT(handleGUIUpdateCheckError(short)),</a>
<a name="ln486">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln487"> </a>
<a name="ln488">        /// First Check for Update</a>
<a name="ln489">        getMethod(m_UpdateInformation.data(), &quot;getInfo(void)&quot;)</a>
<a name="ln490">        .invoke(m_UpdateInformation.data(), Qt::QueuedConnection);</a>
<a name="ln491"> </a>
<a name="ln492">        if(n_GuiFlag &amp; GuiFlag::ShowBeforeProgress) {</a>
<a name="ln493">            (m_Ui-&gt;mainStack)-&gt;setCurrentIndex(0);</a>
<a name="ln494">            showWidget();</a>
<a name="ln495">        }</a>
<a name="ln496">#endif // NO_GUI</a>
<a name="ln497">    } else if(action == Action::Seed) {</a>
<a name="ln498">#ifndef DECENTRALIZED_UPDATE_ENABLED</a>
<a name="ln499">	b_Started = b_CancelRequested = b_Finished = b_Canceled = false;</a>
<a name="ln500">        emit error(QAppImageUpdateEnums::Error::UnsupportedActionForBuild, action);</a>
<a name="ln501">        return;</a>
<a name="ln502">#else</a>
<a name="ln503">	n_CurrentAction = action;</a>
<a name="ln504"> </a>
<a name="ln505">        m_ControlFileParser-&gt;setUseBittorrent(true);</a>
<a name="ln506"> </a>
<a name="ln507">	connect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln508">                m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)),</a>
<a name="ln509">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln510"> </a>
<a name="ln511">        connect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln512">                m_ControlFileParser.data(), SLOT(getUpdateCheckInformation(void)),</a>
<a name="ln513">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln514"> </a>
<a name="ln515">        connect(m_ControlFileParser.data(), SIGNAL(updateCheckInformation(QJsonObject)),</a>
<a name="ln516">                m_Seeder.data(), SLOT(start(QJsonObject)),</a>
<a name="ln517">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln518"> </a>
<a name="ln519">        connect(m_Seeder.data(), SIGNAL(canceled()),</a>
<a name="ln520">                this, SLOT(handleSeedCancel()),</a>
<a name="ln521">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln522"> </a>
<a name="ln523">        connect(m_Seeder.data(), SIGNAL(error(short)),</a>
<a name="ln524">                this, SLOT(handleSeedError(short)),</a>
<a name="ln525">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln526"> </a>
<a name="ln527">        connect(m_ControlFileParser.data(), SIGNAL(error(short)),</a>
<a name="ln528">                this, SLOT(handleSeedError(short)),</a>
<a name="ln529">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln530"> </a>
<a name="ln531">        connect(m_UpdateInformation.data(), SIGNAL(error(short)),</a>
<a name="ln532">                this, SLOT(handleSeedError(short)),</a>
<a name="ln533">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln534"> </a>
<a name="ln535">        emit started(Action::Seed);</a>
<a name="ln536">        getMethod(m_UpdateInformation.data(), &quot;getInfo(void)&quot;)</a>
<a name="ln537">        .invoke(m_UpdateInformation.data(), Qt::QueuedConnection);</a>
<a name="ln538"> </a>
<a name="ln539">#endif // DECENTRALIZED_UPDATE_ENABLED</a>
<a name="ln540">    } else {</a>
<a name="ln541">        n_CurrentAction = Action::None;</a>
<a name="ln542">        b_Started = b_Running = b_Canceled = false;</a>
<a name="ln543">        emit error(QAppImageUpdateEnums::Error::InvalidAction, n_CurrentAction);</a>
<a name="ln544">    }</a>
<a name="ln545">    return;</a>
<a name="ln546">}</a>
<a name="ln547"> </a>
<a name="ln548">void QAppImageUpdatePrivate::cancel(void) {</a>
<a name="ln549">    if(!b_Started &amp;&amp; !b_Running) {</a>
<a name="ln550">        return;</a>
<a name="ln551">    }</a>
<a name="ln552"> </a>
<a name="ln553">    b_CancelRequested = true;</a>
<a name="ln554">    getMethod(m_DeltaWriter.data(),&quot;cancel()&quot;)</a>
<a name="ln555">    .invoke(m_DeltaWriter.data(), Qt::QueuedConnection);</a>
<a name="ln556">    </a>
<a name="ln557">    return;</a>
<a name="ln558">}</a>
<a name="ln559"> </a>
<a name="ln560"> </a>
<a name="ln561">/// * * *</a>
<a name="ln562">/// Private Slots</a>
<a name="ln563">void QAppImageUpdatePrivate::setCurrentAppImagePath(QString path) {</a>
<a name="ln564">    m_CurrentAppImagePath = path;</a>
<a name="ln565">}</a>
<a name="ln566"> </a>
<a name="ln567">void QAppImageUpdatePrivate::handleUpdateProgress(int percentage,</a>
<a name="ln568">        qint64 bytesReceived,</a>
<a name="ln569">        qint64 bytesTotal,</a>
<a name="ln570">        double speed,</a>
<a name="ln571">        QString units) {</a>
<a name="ln572">    emit progress(percentage, bytesReceived, bytesTotal, speed, units, n_CurrentAction);</a>
<a name="ln573">}</a>
<a name="ln574"> </a>
<a name="ln575">void QAppImageUpdatePrivate::handleGetEmbeddedInfoProgress(int percentage) {</a>
<a name="ln576">    emit progress(percentage, 1, 1, 0, QString(), n_CurrentAction);</a>
<a name="ln577">}</a>
<a name="ln578"> </a>
<a name="ln579">void QAppImageUpdatePrivate::handleCheckForUpdateProgress(int percentage) {</a>
<a name="ln580">    emit progress(percentage, 1, 1, 0, QString(), n_CurrentAction);</a>
<a name="ln581">}</a>
<a name="ln582"> </a>
<a name="ln583">void QAppImageUpdatePrivate::handleGetEmbeddedInfoError(short code) {</a>
<a name="ln584">    b_Canceled = b_Started = b_Running = false;</a>
<a name="ln585">    b_Finished = false;</a>
<a name="ln586">    b_CancelRequested = false;</a>
<a name="ln587">    disconnect(m_UpdateInformation.data(),  &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln588">               this, &amp;QAppImageUpdatePrivate::handleGetEmbeddedInfoError);</a>
<a name="ln589">    disconnect(m_UpdateInformation.data(),  &amp;AppImageUpdateInformationPrivate::info,</a>
<a name="ln590">               this, &amp;QAppImageUpdatePrivate::redirectEmbeddedInformation);</a>
<a name="ln591">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::progress,</a>
<a name="ln592">               this, &amp;QAppImageUpdatePrivate::handleGetEmbeddedInfoProgress);</a>
<a name="ln593">    emit error(code, n_CurrentAction);</a>
<a name="ln594">}</a>
<a name="ln595"> </a>
<a name="ln596">void QAppImageUpdatePrivate::redirectEmbeddedInformation(QJsonObject info) {</a>
<a name="ln597">    b_Canceled = b_Started = b_Running = false;</a>
<a name="ln598">    b_Finished = true;</a>
<a name="ln599">    disconnect(m_UpdateInformation.data(),  &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln600">               this, &amp;QAppImageUpdatePrivate::handleGetEmbeddedInfoError);</a>
<a name="ln601">    disconnect(m_UpdateInformation.data(),  &amp;AppImageUpdateInformationPrivate::info,</a>
<a name="ln602">               this, &amp;QAppImageUpdatePrivate::redirectEmbeddedInformation);</a>
<a name="ln603">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::progress,</a>
<a name="ln604">               this, &amp;QAppImageUpdatePrivate::handleGetEmbeddedInfoProgress);</a>
<a name="ln605"> </a>
<a name="ln606">    if(b_CancelRequested) {</a>
<a name="ln607">        b_CancelRequested = false;</a>
<a name="ln608">        b_Canceled = true;</a>
<a name="ln609">        emit canceled(n_CurrentAction);</a>
<a name="ln610">        return;</a>
<a name="ln611">    }</a>
<a name="ln612">    emit finished(info, n_CurrentAction);</a>
<a name="ln613">}</a>
<a name="ln614"> </a>
<a name="ln615"> </a>
<a name="ln616">void QAppImageUpdatePrivate::handleCheckForUpdateError(short code) {</a>
<a name="ln617">    b_Canceled = b_Started = b_Running = false;</a>
<a name="ln618">    b_Finished = false;</a>
<a name="ln619">    b_CancelRequested = false;</a>
<a name="ln620"> </a>
<a name="ln621">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln622">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln623">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln624">               m_ControlFileParser.data(), SLOT(getUpdateCheckInformation(void)));</a>
<a name="ln625">    disconnect(m_ControlFileParser.data(), SIGNAL(updateCheckInformation(QJsonObject)),</a>
<a name="ln626">               this, SLOT(redirectUpdateCheck(QJsonObject)));</a>
<a name="ln627">    disconnect(m_ControlFileParser.data(), SIGNAL(error(short)),</a>
<a name="ln628">               this, SLOT(handleCheckForUpdateError(short)));</a>
<a name="ln629">    disconnect(m_UpdateInformation.data(), SIGNAL(error(short)),</a>
<a name="ln630">               this, SLOT(handleCheckForUpdateError(short)));</a>
<a name="ln631">    disconnect(m_ControlFileParser.data(), SIGNAL(progress(int)),</a>
<a name="ln632">               this, SLOT(handleCheckForUpdateProgress(int)));</a>
<a name="ln633"> </a>
<a name="ln634">    emit error(code, n_CurrentAction);</a>
<a name="ln635">}</a>
<a name="ln636"> </a>
<a name="ln637">void QAppImageUpdatePrivate::handleSeedError(short code) {</a>
<a name="ln638">    b_Canceled = b_Started = b_Running = false;</a>
<a name="ln639">    b_Finished = false;</a>
<a name="ln640">    b_CancelRequested = false;</a>
<a name="ln641"> </a>
<a name="ln642">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln643">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln644">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln645">               m_ControlFileParser.data(), SLOT(getUpdateCheckInformation(void)));</a>
<a name="ln646">    disconnect(m_ControlFileParser.data(), SIGNAL(updateCheckInformation(QJsonObject)),</a>
<a name="ln647">                m_Seeder.data(), SLOT(start(QJsonObject)));</a>
<a name="ln648">    disconnect(m_ControlFileParser.data(), SIGNAL(error(short)),</a>
<a name="ln649">               this, SLOT(handleSeedError(short)));</a>
<a name="ln650">    disconnect(m_UpdateInformation.data(), SIGNAL(error(short)),</a>
<a name="ln651">               this, SLOT(handleSeedError(short)));</a>
<a name="ln652">    disconnect(m_Seeder.data(), SIGNAL(canceled()),</a>
<a name="ln653">                this, SLOT(handleSeedCancel()));</a>
<a name="ln654">    disconnect(m_Seeder.data(), SIGNAL(error(short)),</a>
<a name="ln655">                this, SLOT(handleSeedError(short)));</a>
<a name="ln656"> </a>
<a name="ln657">    emit error(code, n_CurrentAction);</a>
<a name="ln658">}</a>
<a name="ln659"> </a>
<a name="ln660">void QAppImageUpdatePrivate::handleSeedCancel() {</a>
<a name="ln661">    b_Canceled = b_Started = b_Running = false;</a>
<a name="ln662">    b_Finished = false;</a>
<a name="ln663">    b_CancelRequested = false;</a>
<a name="ln664"> </a>
<a name="ln665">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln666">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln667">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln668">               m_ControlFileParser.data(), SLOT(getUpdateCheckInformation(void)));</a>
<a name="ln669">    disconnect(m_ControlFileParser.data(), SIGNAL(updateCheckInformation(QJsonObject)),</a>
<a name="ln670">                m_Seeder.data(), SLOT(start(QJsonObject)));</a>
<a name="ln671">    disconnect(m_ControlFileParser.data(), SIGNAL(error(short)),</a>
<a name="ln672">               this, SLOT(handleSeedError(short)));</a>
<a name="ln673">    disconnect(m_UpdateInformation.data(), SIGNAL(error(short)),</a>
<a name="ln674">               this, SLOT(handleSeedError(short)));</a>
<a name="ln675">    disconnect(m_Seeder.data(), SIGNAL(canceled()),</a>
<a name="ln676">                this, SLOT(handleSeedCancel()));</a>
<a name="ln677">    disconnect(m_Seeder.data(), SIGNAL(error(short)),</a>
<a name="ln678">                this, SLOT(handleSeedError(short)));</a>
<a name="ln679"> </a>
<a name="ln680">    b_Finished = true;</a>
<a name="ln681"> </a>
<a name="ln682">    QJsonObject r { };</a>
<a name="ln683">    emit finished(r, n_CurrentAction);</a>
<a name="ln684">}</a>
<a name="ln685"> </a>
<a name="ln686">void QAppImageUpdatePrivate::redirectUpdateCheck(QJsonObject info) {</a>
<a name="ln687">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln688">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln689">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln690">               m_ControlFileParser.data(), SLOT(getUpdateCheckInformation(void)));</a>
<a name="ln691">    disconnect(m_ControlFileParser.data(), SIGNAL(updateCheckInformation(QJsonObject)),</a>
<a name="ln692">               this, SLOT(redirectUpdateCheck(QJsonObject)));</a>
<a name="ln693">    disconnect(m_ControlFileParser.data(), SIGNAL(error(short)),</a>
<a name="ln694">               this, SLOT(handleCheckForUpdateError(short)));</a>
<a name="ln695">    disconnect(m_UpdateInformation.data(), SIGNAL(error(short)),</a>
<a name="ln696">               this, SLOT(handleCheckForUpdateError(short)));</a>
<a name="ln697">    disconnect(m_ControlFileParser.data(), SIGNAL(progress(int)),</a>
<a name="ln698">               this, SLOT(handleCheckForUpdateProgress(int)));</a>
<a name="ln699"> </a>
<a name="ln700"> </a>
<a name="ln701">    // Can this happen without an error?</a>
<a name="ln702">    if(info.isEmpty()) {</a>
<a name="ln703">        return;</a>
<a name="ln704">    }</a>
<a name="ln705"> </a>
<a name="ln706">    auto releaseNotes = info[&quot;ReleaseNotes&quot;].toString();</a>
<a name="ln707">    auto embeddedUpdateInformation = info[&quot;EmbededUpdateInformation&quot;].toObject();</a>
<a name="ln708">    auto oldVersionInformation = embeddedUpdateInformation[&quot;FileInformation&quot;].toObject();</a>
<a name="ln709"> </a>
<a name="ln710">    QString remoteTargetFileSHA1Hash = info[&quot;RemoteTargetFileSHA1Hash&quot;].toString(),</a>
<a name="ln711">            localAppImageSHA1Hash = oldVersionInformation[&quot;AppImageSHA1Hash&quot;].toString(),</a>
<a name="ln712">            localAppImagePath = oldVersionInformation[&quot;AppImageFilePath&quot;].toString();</a>
<a name="ln713"> </a>
<a name="ln714">    bool torrentSupported = info[&quot;TorrentSupported&quot;].toBool();</a>
<a name="ln715">    auto torrentFileUrl = info[&quot;TorrentFileUrl&quot;].toString();</a>
<a name="ln716">    auto targetFileName = info[&quot;RemoteTargetFileName&quot;].toString();</a>
<a name="ln717"> </a>
<a name="ln718">    QJsonObject updateinfo {</a>
<a name="ln719">        { &quot;UpdateAvailable&quot;, localAppImageSHA1Hash != remoteTargetFileSHA1Hash},</a>
<a name="ln720">        { &quot;AbsolutePath&quot;, localAppImagePath},</a>
<a name="ln721">	{ &quot;RemoteTargetFileName&quot;, targetFileName}, </a>
<a name="ln722">	{ &quot;LocalSha1Hash&quot;,  localAppImageSHA1Hash },</a>
<a name="ln723">        { &quot;RemoteSha1Hash&quot;, remoteTargetFileSHA1Hash},</a>
<a name="ln724">        { &quot;ReleaseNotes&quot;, releaseNotes},</a>
<a name="ln725">        { &quot;TorrentSupported&quot;, torrentSupported},</a>
<a name="ln726">	{ &quot;TorrentFileUrl&quot;, torrentFileUrl }</a>
<a name="ln727">    };</a>
<a name="ln728"> </a>
<a name="ln729">    b_Started = b_Running = false;</a>
<a name="ln730">    b_Finished = true;</a>
<a name="ln731">    b_Canceled = false;</a>
<a name="ln732"> </a>
<a name="ln733"> </a>
<a name="ln734">    if(b_CancelRequested) {</a>
<a name="ln735">        b_CancelRequested = false;</a>
<a name="ln736">        b_Canceled = true;</a>
<a name="ln737">        emit canceled(n_CurrentAction);</a>
<a name="ln738">        return;</a>
<a name="ln739">    }</a>
<a name="ln740">    emit finished(updateinfo, n_CurrentAction);</a>
<a name="ln741">}</a>
<a name="ln742"> </a>
<a name="ln743">void QAppImageUpdatePrivate::handleUpdateStart() {</a>
<a name="ln744">    emit started(n_CurrentAction);</a>
<a name="ln745">}</a>
<a name="ln746"> </a>
<a name="ln747">void QAppImageUpdatePrivate::handleUpdateCancel() {</a>
<a name="ln748">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln749">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln750">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln751">               m_ControlFileParser.data(), SLOT(getZsyncInformation(void)));</a>
<a name="ln752">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln753">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration);</a>
<a name="ln754">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln755">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start);</a>
<a name="ln756">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln757">               this, &amp;QAppImageUpdatePrivate::handleUpdateFinished);</a>
<a name="ln758">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln759">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln760">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln761">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln762">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln763">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln764">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln765">               this, &amp;QAppImageUpdatePrivate::handleUpdateProgress);</a>
<a name="ln766">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln767">               this, &amp;QAppImageUpdatePrivate::handleUpdateCancel);</a>
<a name="ln768"> </a>
<a name="ln769">    b_Started = b_Running = b_Finished = b_CancelRequested = false;</a>
<a name="ln770">    b_Canceled = true;</a>
<a name="ln771"> </a>
<a name="ln772">    emit canceled(n_CurrentAction);</a>
<a name="ln773"> </a>
<a name="ln774">}</a>
<a name="ln775"> </a>
<a name="ln776">void QAppImageUpdatePrivate::handleUpdateError(short ecode) {</a>
<a name="ln777">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln778">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln779">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln780">               m_ControlFileParser.data(), SLOT(getZsyncInformation(void)));</a>
<a name="ln781">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln782">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration);</a>
<a name="ln783">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln784">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start);</a>
<a name="ln785">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln786">               this, &amp;QAppImageUpdatePrivate::handleUpdateFinished);</a>
<a name="ln787">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln788">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln789">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln790">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln791">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln792">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln793">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln794">               this, &amp;QAppImageUpdatePrivate::handleUpdateProgress);</a>
<a name="ln795">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln796">               this, &amp;QAppImageUpdatePrivate::handleUpdateCancel);</a>
<a name="ln797"> </a>
<a name="ln798"> </a>
<a name="ln799">    b_Started = b_Running = b_Finished = false;</a>
<a name="ln800">    b_Canceled = false;</a>
<a name="ln801"> </a>
<a name="ln802">    if(b_CancelRequested) {</a>
<a name="ln803">        b_CancelRequested = false;</a>
<a name="ln804">        b_Canceled = true;</a>
<a name="ln805">        emit canceled(n_CurrentAction);</a>
<a name="ln806">        return;</a>
<a name="ln807">    }</a>
<a name="ln808"> </a>
<a name="ln809">    emit error(ecode, n_CurrentAction);</a>
<a name="ln810">}</a>
<a name="ln811"> </a>
<a name="ln812">void QAppImageUpdatePrivate::handleUpdateFinished(QJsonObject info, QString oldVersionPath) {</a>
<a name="ln813">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln814">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln815">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln816">               m_ControlFileParser.data(), SLOT(getZsyncInformation(void)));</a>
<a name="ln817">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln818">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration);</a>
<a name="ln819">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln820">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start);</a>
<a name="ln821">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln822">               this, &amp;QAppImageUpdatePrivate::handleUpdateFinished);</a>
<a name="ln823">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln824">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln825">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln826">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln827">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln828">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln829">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln830">               this, &amp;QAppImageUpdatePrivate::handleUpdateProgress);</a>
<a name="ln831">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln832">               this, &amp;QAppImageUpdatePrivate::handleUpdateCancel);</a>
<a name="ln833"> </a>
<a name="ln834"> </a>
<a name="ln835">    QJsonObject result {</a>
<a name="ln836">        {&quot;OldVersionPath&quot;, oldVersionPath},</a>
<a name="ln837">        {&quot;NewVersionPath&quot;, info[&quot;AbsolutePath&quot;].toString()},</a>
<a name="ln838">        {&quot;NewVersionSha1Hash&quot;, info[&quot;Sha1Hash&quot;].toString()},</a>
<a name="ln839">        {&quot;UsedTorrent&quot;, info[&quot;UsedTorrent&quot;].toBool()},</a>
<a name="ln840">	{&quot;TorrentFileUrl&quot;, info[&quot;TorrentFileUrl&quot;].toString()}</a>
<a name="ln841">    };</a>
<a name="ln842">    b_Started = b_Running = false;</a>
<a name="ln843">    b_Finished = true;</a>
<a name="ln844">    b_Canceled = false;</a>
<a name="ln845"> </a>
<a name="ln846">    if(b_CancelRequested) {</a>
<a name="ln847">        b_CancelRequested = false;</a>
<a name="ln848">        b_Canceled = true;</a>
<a name="ln849">        emit canceled(n_CurrentAction);</a>
<a name="ln850">        return;</a>
<a name="ln851">    }</a>
<a name="ln852"> </a>
<a name="ln853">    emit finished(result, n_CurrentAction);</a>
<a name="ln854">}</a>
<a name="ln855"> </a>
<a name="ln856"> </a>
<a name="ln857">/// GUI Update routines.</a>
<a name="ln858"> </a>
<a name="ln859">#ifndef NO_GUI</a>
<a name="ln860">void QAppImageUpdatePrivate::showWidget() {</a>
<a name="ln861">    if(m_Ui.isNull() || m_UpdaterDialog.isNull()) {</a>
<a name="ln862">        return;</a>
<a name="ln863">    }</a>
<a name="ln864">    if(!(n_GuiFlag &amp; GuiFlag::ShowProgressDialog) &amp;&amp;</a>
<a name="ln865">            (m_Ui-&gt;mainStack)-&gt;currentIndex() != 0) {</a>
<a name="ln866">        return;</a>
<a name="ln867">    }</a>
<a name="ln868">    m_UpdaterDialog-&gt;show();</a>
<a name="ln869">    return;</a>
<a name="ln870">}</a>
<a name="ln871"> </a>
<a name="ln872">void QAppImageUpdatePrivate::handleGUIConfirmationRejected() {</a>
<a name="ln873">    handleGUIUpdateCancel();</a>
<a name="ln874">}</a>
<a name="ln875"> </a>
<a name="ln876">void QAppImageUpdatePrivate::handleGUIConfirmationAccepted() {</a>
<a name="ln877">    doGUIUpdate();</a>
<a name="ln878">}</a>
<a name="ln879"> </a>
<a name="ln880">void QAppImageUpdatePrivate::doGUIUpdate() {</a>
<a name="ln881">    connect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln882">            m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)),</a>
<a name="ln883">            (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln884"> </a>
<a name="ln885">    connect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln886">            m_ControlFileParser.data(), SLOT(getZsyncInformation(void)),</a>
<a name="ln887">            (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln888"> </a>
<a name="ln889">    connect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln890">            m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration,</a>
<a name="ln891">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln892"> </a>
<a name="ln893">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln894">            m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start,</a>
<a name="ln895">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln896"> </a>
<a name="ln897">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln898">            this, &amp;QAppImageUpdatePrivate::handleGUIUpdateFinished,</a>
<a name="ln899">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln900"> </a>
<a name="ln901">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln902">            this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError,</a>
<a name="ln903">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln904"> </a>
<a name="ln905">    connect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln906">            this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError,</a>
<a name="ln907">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln908"> </a>
<a name="ln909">    connect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln910">            this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError,</a>
<a name="ln911">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln912"> </a>
<a name="ln913">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln914">            this, &amp;QAppImageUpdatePrivate::handleGUIUpdateProgress,</a>
<a name="ln915">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln916"> </a>
<a name="ln917">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln918">            this, &amp;QAppImageUpdatePrivate::handleGUIUpdateCancel,</a>
<a name="ln919">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln920"> </a>
<a name="ln921">    getMethod(m_UpdateInformation.data(), &quot;getInfo(void)&quot;)</a>
<a name="ln922">    .invoke(m_UpdateInformation.data(), Qt::QueuedConnection);</a>
<a name="ln923"> </a>
<a name="ln924"> </a>
<a name="ln925">    showWidget();</a>
<a name="ln926">}</a>
<a name="ln927"> </a>
<a name="ln928">void QAppImageUpdatePrivate::handleGUIUpdateCheck(QJsonObject info) {</a>
<a name="ln929">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln930">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln931"> </a>
<a name="ln932">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln933">               m_ControlFileParser.data(), SLOT(getUpdateCheckInformation(void)));</a>
<a name="ln934">    disconnect(m_ControlFileParser.data(), SIGNAL(updateCheckInformation(QJsonObject)),</a>
<a name="ln935">               this, SLOT(handleGUIUpdateCheck(QJsonObject)));</a>
<a name="ln936">    disconnect(m_ControlFileParser.data(), SIGNAL(progress(int)),</a>
<a name="ln937">               this, SLOT(handleGUIUpdateCheckProgress(int)));</a>
<a name="ln938">    disconnect(m_ControlFileParser.data(), SIGNAL(error(short)),</a>
<a name="ln939">               this, SLOT(handleGUIUpdateCheckError(short)));</a>
<a name="ln940">    disconnect(m_UpdateInformation.data(), SIGNAL(error(short)),</a>
<a name="ln941">               this, SLOT(handleGUIUpdateCheckError(short)));</a>
<a name="ln942"> </a>
<a name="ln943"> </a>
<a name="ln944">    /// Connect confirmation buttons</a>
<a name="ln945">    connect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::rejected,</a>
<a name="ln946">            this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationRejected, Qt::QueuedConnection);</a>
<a name="ln947">    connect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::accepted,</a>
<a name="ln948">            this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationAccepted, Qt::QueuedConnection);</a>
<a name="ln949"> </a>
<a name="ln950"> </a>
<a name="ln951"> </a>
<a name="ln952">    if(b_CancelRequested) {</a>
<a name="ln953">        b_Started = b_Running = b_Finished = false;</a>
<a name="ln954">        b_Canceled = false;</a>
<a name="ln955">        b_CancelRequested = false;</a>
<a name="ln956">        b_Canceled = true;</a>
<a name="ln957">        emit canceled(n_CurrentAction);</a>
<a name="ln958">        return;</a>
<a name="ln959">    }</a>
<a name="ln960"> </a>
<a name="ln961"> </a>
<a name="ln962"> </a>
<a name="ln963">    m_UpdaterDialog-&gt;hide();</a>
<a name="ln964">    m_UpdaterDialog-&gt;move(QGuiApplication::primaryScreen()-&gt;geometry().center() - m_UpdaterDialog-&gt;rect().center());</a>
<a name="ln965">    (m_Ui-&gt;mainStack)-&gt;setCurrentIndex(1);</a>
<a name="ln966"> </a>
<a name="ln967">    auto notes = info[&quot;ReleaseNotes&quot;].toString();</a>
<a name="ln968">    auto embeddedUpdateInformation = info[&quot;EmbededUpdateInformation&quot;].toObject();</a>
<a name="ln969">    auto oldVersionInformation = embeddedUpdateInformation[&quot;FileInformation&quot;].toObject();</a>
<a name="ln970"> </a>
<a name="ln971">    QString remoteTargetFileSHA1Hash = info[&quot;RemoteTargetFileSHA1Hash&quot;].toString(),</a>
<a name="ln972">            localAppImageSHA1Hash = oldVersionInformation[&quot;AppImageSHA1Hash&quot;].toString(),</a>
<a name="ln973">            localAppImagePath = oldVersionInformation[&quot;AppImageFilePath&quot;].toString();</a>
<a name="ln974"> </a>
<a name="ln975">    bool torrentSupported = info[&quot;TorrentSupported&quot;].toBool();</a>
<a name="ln976"> </a>
<a name="ln977">    bool showUpdateDialog = n_GuiFlag &amp; GuiFlag::ShowUpdateConfirmationDialog;</a>
<a name="ln978">    bool showNoUpdateDialog = n_GuiFlag &amp; GuiFlag::NotifyWhenNoUpdateIsAvailable;</a>
<a name="ln979">    bool noConfirmTorrentUsage = n_GuiFlag &amp; GuiFlag::NoConfirmTorrentUsage;</a>
<a name="ln980">    m_UpdaterDialog-&gt;setWindowTitle(QString::fromUtf8(&quot;Updating &quot;) +</a>
<a name="ln981">		    		   (m_ApplicationName.isEmpty() ? </a>
<a name="ln982">				    QFileInfo(localAppImagePath).baseName() : </a>
<a name="ln983">				    m_ApplicationName));</a>
<a name="ln984"> </a>
<a name="ln985">    bool isUpdateAvailable = (localAppImageSHA1Hash != remoteTargetFileSHA1Hash);</a>
<a name="ln986"> </a>
<a name="ln987"> </a>
<a name="ln988">    if(isUpdateAvailable) {</a>
<a name="ln989">        if(torrentSupported) {</a>
<a name="ln990">            bool permission = true;</a>
<a name="ln991">            if(!noConfirmTorrentUsage) {</a>
<a name="ln992">                QMessageBox box(m_UpdaterDialog.data());</a>
<a name="ln993">                box.setWindowTitle(QString::fromUtf8(&quot;Torrent Usage Permission&quot;));</a>
<a name="ln994">                box.setIcon(QMessageBox::Information);</a>
<a name="ln995">                box.setText(</a>
<a name="ln996">                    QString::fromUtf8(</a>
<a name="ln997">                        &quot;It seems that the author of &quot;) +</a>
<a name="ln998">                    (m_ApplicationName.isEmpty() ? QFileInfo(localAppImagePath).baseName() : </a>
<a name="ln999">		     m_ApplicationName) +</a>
<a name="ln1000">                    QString::fromUtf8(&quot; supports decentralized update via Bittorrent.&quot;) +</a>
<a name="ln1001">                    QString::fromUtf8(</a>
<a name="ln1002">                        &quot; Do you agree to &lt;b&gt;use Bittorrent for decentralized update?&lt;/b&gt; This is completely optional.&quot;) +</a>
<a name="ln1003">                    QString::fromUtf8(</a>
<a name="ln1004">                        &quot; &lt;b&gt;Please click 'No' if you don't understand the question&lt;/b&gt;.&quot;)</a>
<a name="ln1005">                );</a>
<a name="ln1006">                box.addButton(QMessageBox::Yes);</a>
<a name="ln1007">                box.addButton(QMessageBox::No);</a>
<a name="ln1008">                permission = (box.exec() == QMessageBox::Yes);</a>
<a name="ln1009"> </a>
<a name="ln1010">            }</a>
<a name="ln1011"> </a>
<a name="ln1012">            if(!permission) {</a>
<a name="ln1013">                m_ControlFileParser-&gt;setUseBittorrent(false);</a>
<a name="ln1014">            }</a>
<a name="ln1015">        }</a>
<a name="ln1016">        if(showUpdateDialog) {</a>
<a name="ln1017">            QString oldSha = localAppImageSHA1Hash,</a>
<a name="ln1018">                    newSha = remoteTargetFileSHA1Hash;</a>
<a name="ln1019">            /* we don't need the full sha to show the diff. */</a>
<a name="ln1020">            oldSha.resize(7);</a>
<a name="ln1021">            newSha.resize(7);</a>
<a name="ln1022"> </a>
<a name="ln1023">            oldSha = oldSha.toLower();</a>
<a name="ln1024">            newSha = newSha.toLower();</a>
<a name="ln1025"> </a>
<a name="ln1026">            m_ConfirmationDialog-&gt;init( m_ApplicationName, oldSha, newSha, notes);</a>
<a name="ln1027">        } else {</a>
<a name="ln1028">            // Auto confirm if we are not showing the confirm dialog.</a>
<a name="ln1029">            doGUIUpdate();</a>
<a name="ln1030">        }</a>
<a name="ln1031">    } else {</a>
<a name="ln1032">        if(showNoUpdateDialog) {</a>
<a name="ln1033">            QMessageBox box(m_UpdaterDialog.data());</a>
<a name="ln1034">            box.setWindowTitle(QString::fromUtf8(&quot;No Updates Available!&quot;));</a>
<a name="ln1035">            box.setText(</a>
<a name="ln1036">                QString::fromUtf8(&quot;You are currently using the lastest version of &quot;) +\</a>
<a name="ln1037">		(m_ApplicationName.isEmpty() ? QFileInfo(localAppImagePath).fileName()</a>
<a name="ln1038">		 : m_ApplicationName ) +</a>
<a name="ln1039">                QString::fromUtf8(&quot;.&quot;));</a>
<a name="ln1040">            box.exec();</a>
<a name="ln1041">        }</a>
<a name="ln1042"> </a>
<a name="ln1043">        QJsonObject result {</a>
<a name="ln1044">            {&quot;OldVersionPath&quot;, localAppImagePath},</a>
<a name="ln1045">            {&quot;NewVersionPath&quot;, localAppImagePath},</a>
<a name="ln1046">            {&quot;NewVersionSha1Hash&quot;, localAppImageSHA1Hash},</a>
<a name="ln1047">            {&quot;UsedTorrent&quot;, false}</a>
<a name="ln1048">        };</a>
<a name="ln1049">        b_Started = b_Running = false;</a>
<a name="ln1050">        b_Finished = true;</a>
<a name="ln1051">        b_Canceled = false;</a>
<a name="ln1052"> </a>
<a name="ln1053">        emit finished(result, n_CurrentAction);</a>
<a name="ln1054">    }</a>
<a name="ln1055"> </a>
<a name="ln1056">}</a>
<a name="ln1057"> </a>
<a name="ln1058"> </a>
<a name="ln1059"> </a>
<a name="ln1060">void QAppImageUpdatePrivate::handleGUIUpdateCheckError(short ecode) {</a>
<a name="ln1061">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln1062">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln1063"> </a>
<a name="ln1064">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln1065">               m_ControlFileParser.data(), SLOT(getUpdateCheckInformation(void)));</a>
<a name="ln1066">    disconnect(m_ControlFileParser.data(), SIGNAL(updateCheckInformation(QJsonObject)),</a>
<a name="ln1067">               this, SLOT(handleGUIUpdateCheck(QJsonObject)));</a>
<a name="ln1068">    disconnect(m_ControlFileParser.data(), SIGNAL(progress(int)),</a>
<a name="ln1069">               this, SLOT(handleGUIUpdateCheckProgress(int)));</a>
<a name="ln1070">    disconnect(m_ControlFileParser.data(), SIGNAL(error(short)),</a>
<a name="ln1071">               this, SLOT(handleGUIUpdateCheckError(short)));</a>
<a name="ln1072">    disconnect(m_UpdateInformation.data(), SIGNAL(error(short)),</a>
<a name="ln1073">               this, SLOT(handleGUIUpdateCheckError(short)));</a>
<a name="ln1074"> </a>
<a name="ln1075">    if(b_CancelRequested) {</a>
<a name="ln1076">        b_Started = b_Running = b_Finished = false;</a>
<a name="ln1077">        b_Canceled = false;</a>
<a name="ln1078">        b_CancelRequested = false;</a>
<a name="ln1079">        b_Canceled = true;</a>
<a name="ln1080">        emit canceled(n_CurrentAction);</a>
<a name="ln1081">        return;</a>
<a name="ln1082">    }</a>
<a name="ln1083"> </a>
<a name="ln1084">    bool show = n_GuiFlag &amp; GuiFlag::ShowErrorDialog;</a>
<a name="ln1085"> </a>
<a name="ln1086"> </a>
<a name="ln1087">    QString errorString = QAppImageUpdatePrivate::errorCodeToDescriptionString(ecode);</a>
<a name="ln1088">    if(ecode == QAppImageUpdateEnums::Error::NoReadPermission ||</a>
<a name="ln1089">            ecode == QAppImageUpdateEnums::Error::NoPermissionToReadSourceFile ||</a>
<a name="ln1090">            ecode == QAppImageUpdateEnums::Error::NoPermissionToReadWriteTargetFile) {</a>
<a name="ln1091">        if(n_GuiFlag &amp; GuiFlag::NoShowErrorDialogOnPermissionErrors) {</a>
<a name="ln1092">            show = false;</a>
<a name="ln1093">        }</a>
<a name="ln1094">    }</a>
<a name="ln1095"> </a>
<a name="ln1096">    if(show) {</a>
<a name="ln1097">        QMessageBox box(m_UpdaterDialog.data());</a>
<a name="ln1098">        box.setWindowTitle(QString::fromUtf8(&quot;Update Failed&quot;));</a>
<a name="ln1099">        box.setIcon(QMessageBox::Critical);</a>
<a name="ln1100">        box.setText(QString::fromUtf8(&quot;Update failed for '&quot;) +</a>
<a name="ln1101">                    QFileInfo(m_CurrentAppImagePath).fileName() +</a>
<a name="ln1102">                    QString::fromUtf8(&quot;': &quot;) + errorString);</a>
<a name="ln1103">        box.exec();</a>
<a name="ln1104">    }</a>
<a name="ln1105"> </a>
<a name="ln1106"> </a>
<a name="ln1107">    emit error(ecode, n_CurrentAction);</a>
<a name="ln1108">    m_UpdaterDialog-&gt;hide();</a>
<a name="ln1109">    return;</a>
<a name="ln1110">}</a>
<a name="ln1111"> </a>
<a name="ln1112">void QAppImageUpdatePrivate::handleGUIUpdateCheckProgress(int percentage) {</a>
<a name="ln1113">	Q_UNUSED(percentage);</a>
<a name="ln1114">}</a>
<a name="ln1115"> </a>
<a name="ln1116"> </a>
<a name="ln1117">void QAppImageUpdatePrivate::handleGUIUpdateProgress(int percentage,</a>
<a name="ln1118">        qint64 bytesReceived,</a>
<a name="ln1119">        qint64 bytesTotal,</a>
<a name="ln1120">        double speed,</a>
<a name="ln1121">        QString units) {</a>
<a name="ln1122">    //// Show that we are canceling if cancel was requested.</a>
<a name="ln1123">    if(b_CancelRequested) {</a>
<a name="ln1124">        (m_Ui-&gt;updateSpeedLbl)-&gt;setText(QString::fromUtf8(&quot;Rolling back changes, Please wait... &quot;));</a>
<a name="ln1125">        return;</a>
<a name="ln1126">    }</a>
<a name="ln1127"> </a>
<a name="ln1128">    (m_Ui-&gt;progressBar)-&gt;setValue(percentage);</a>
<a name="ln1129">    double MegaBytesReceived = bytesReceived / 1048576;</a>
<a name="ln1130">    double MegaBytesTotal = bytesTotal / 1048576;</a>
<a name="ln1131">    const QString progressTemplate = QString::fromUtf8(&quot;Updating %1 MiB of %2 MiB at %3 %4...&quot;);</a>
<a name="ln1132">    QString statusText = progressTemplate.arg(MegaBytesReceived).arg(MegaBytesTotal).arg(speed).arg(units);</a>
<a name="ln1133">    (m_Ui-&gt;updateSpeedLbl)-&gt;setText(statusText);</a>
<a name="ln1134">}</a>
<a name="ln1135"> </a>
<a name="ln1136"> </a>
<a name="ln1137">void QAppImageUpdatePrivate::handleGUIUpdateStart() {</a>
<a name="ln1138">    emit started(n_CurrentAction);</a>
<a name="ln1139">}</a>
<a name="ln1140"> </a>
<a name="ln1141">void QAppImageUpdatePrivate::handleGUIUpdateCancel() {</a>
<a name="ln1142">    m_UpdaterDialog-&gt;hide();</a>
<a name="ln1143"> </a>
<a name="ln1144">    disconnect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::rejected,</a>
<a name="ln1145">               this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationRejected);</a>
<a name="ln1146">    disconnect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::accepted,</a>
<a name="ln1147">               this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationAccepted);</a>
<a name="ln1148"> </a>
<a name="ln1149">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln1150">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln1151"> </a>
<a name="ln1152">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln1153">               m_ControlFileParser.data(), SLOT(getZsyncInformation(void)));</a>
<a name="ln1154"> </a>
<a name="ln1155">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln1156">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration);</a>
<a name="ln1157"> </a>
<a name="ln1158">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln1159">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start);</a>
<a name="ln1160"> </a>
<a name="ln1161">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln1162">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateFinished);</a>
<a name="ln1163"> </a>
<a name="ln1164">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln1165">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1166"> </a>
<a name="ln1167">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln1168">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1169"> </a>
<a name="ln1170">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln1171">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1172"> </a>
<a name="ln1173">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln1174">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateProgress);</a>
<a name="ln1175"> </a>
<a name="ln1176">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln1177">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateCancel);</a>
<a name="ln1178"> </a>
<a name="ln1179">    b_Started = b_Running = b_Finished = b_CancelRequested = false;</a>
<a name="ln1180">    b_Canceled = true;</a>
<a name="ln1181"> </a>
<a name="ln1182">    emit canceled(n_CurrentAction);</a>
<a name="ln1183">}</a>
<a name="ln1184"> </a>
<a name="ln1185">void QAppImageUpdatePrivate::handleGUIUpdateError(short ecode) {</a>
<a name="ln1186">    disconnect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::rejected,</a>
<a name="ln1187">               this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationRejected);</a>
<a name="ln1188">    disconnect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::accepted,</a>
<a name="ln1189">               this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationAccepted);</a>
<a name="ln1190"> </a>
<a name="ln1191">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln1192">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln1193"> </a>
<a name="ln1194">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln1195">               m_ControlFileParser.data(), SLOT(getZsyncInformation(void)));</a>
<a name="ln1196"> </a>
<a name="ln1197">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln1198">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration);</a>
<a name="ln1199"> </a>
<a name="ln1200">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln1201">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start);</a>
<a name="ln1202"> </a>
<a name="ln1203">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln1204">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateFinished);</a>
<a name="ln1205"> </a>
<a name="ln1206">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln1207">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1208"> </a>
<a name="ln1209">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln1210">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1211"> </a>
<a name="ln1212">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln1213">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1214"> </a>
<a name="ln1215">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln1216">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateProgress);</a>
<a name="ln1217"> </a>
<a name="ln1218">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln1219">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateCancel);</a>
<a name="ln1220"> </a>
<a name="ln1221"> </a>
<a name="ln1222">    b_Started = b_Running = b_Finished = false;</a>
<a name="ln1223">    b_Canceled = false;</a>
<a name="ln1224"> </a>
<a name="ln1225">    if(b_CancelRequested) {</a>
<a name="ln1226">        b_CancelRequested = false;</a>
<a name="ln1227">        b_Canceled = true;</a>
<a name="ln1228">        emit canceled(n_CurrentAction);</a>
<a name="ln1229">        return;</a>
<a name="ln1230">    }</a>
<a name="ln1231"> </a>
<a name="ln1232">    bool show = n_GuiFlag &amp; GuiFlag::ShowErrorDialog;</a>
<a name="ln1233"> </a>
<a name="ln1234"> </a>
<a name="ln1235">    QString errorString = QAppImageUpdatePrivate::errorCodeToDescriptionString(ecode);</a>
<a name="ln1236">    if(ecode == QAppImageUpdateEnums::Error::NoReadPermission ||</a>
<a name="ln1237">            ecode == QAppImageUpdateEnums::Error::NoPermissionToReadSourceFile ||</a>
<a name="ln1238">            ecode == QAppImageUpdateEnums::Error::NoPermissionToReadWriteTargetFile) {</a>
<a name="ln1239">        if(n_GuiFlag &amp; GuiFlag::NoShowErrorDialogOnPermissionErrors) {</a>
<a name="ln1240">            show = false;</a>
<a name="ln1241">        }</a>
<a name="ln1242">    }</a>
<a name="ln1243"> </a>
<a name="ln1244">    if(show) {</a>
<a name="ln1245">        QMessageBox box(m_UpdaterDialog.data());</a>
<a name="ln1246">        box.setWindowTitle(QString::fromUtf8(&quot;Update Failed&quot;));</a>
<a name="ln1247">        box.setIcon(QMessageBox::Critical);</a>
<a name="ln1248">        box.setText(QString::fromUtf8(&quot;Update failed for '&quot;) +</a>
<a name="ln1249">                    (m_ApplicationName.isEmpty() ? QFileInfo(m_CurrentAppImagePath).fileName() : m_ApplicationName) +</a>
<a name="ln1250">                    QString::fromUtf8(&quot;': &quot;) + errorString);</a>
<a name="ln1251">        box.exec();</a>
<a name="ln1252">    }</a>
<a name="ln1253"> </a>
<a name="ln1254"> </a>
<a name="ln1255">    emit error(ecode, n_CurrentAction);</a>
<a name="ln1256">    m_UpdaterDialog-&gt;hide();</a>
<a name="ln1257">    return;</a>
<a name="ln1258">}</a>
<a name="ln1259"> </a>
<a name="ln1260">void QAppImageUpdatePrivate::handleGUIUpdateFinished(QJsonObject info, QString oldVersionPath) {</a>
<a name="ln1261">    disconnect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::rejected,</a>
<a name="ln1262">               this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationRejected);</a>
<a name="ln1263">    disconnect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::accepted,</a>
<a name="ln1264">               this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationAccepted);</a>
<a name="ln1265"> </a>
<a name="ln1266">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln1267">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln1268"> </a>
<a name="ln1269">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln1270">               m_ControlFileParser.data(), SLOT(getZsyncInformation(void)));</a>
<a name="ln1271"> </a>
<a name="ln1272">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln1273">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration);</a>
<a name="ln1274"> </a>
<a name="ln1275">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln1276">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start);</a>
<a name="ln1277"> </a>
<a name="ln1278">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln1279">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateFinished);</a>
<a name="ln1280"> </a>
<a name="ln1281">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln1282">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1283"> </a>
<a name="ln1284">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln1285">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1286"> </a>
<a name="ln1287">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln1288">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1289"> </a>
<a name="ln1290">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln1291">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateProgress);</a>
<a name="ln1292"> </a>
<a name="ln1293">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln1294">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateCancel);</a>
<a name="ln1295"> </a>
<a name="ln1296"> </a>
<a name="ln1297"> </a>
<a name="ln1298">    QJsonObject result {</a>
<a name="ln1299">        {&quot;OldVersionPath&quot;, oldVersionPath},</a>
<a name="ln1300">        {&quot;NewVersionPath&quot;, info[&quot;AbsolutePath&quot;].toString()},</a>
<a name="ln1301">        {&quot;NewVersionSha1Hash&quot;, info[&quot;Sha1Hash&quot;].toString()},</a>
<a name="ln1302">        {&quot;UsedTorrent&quot;, info[&quot;UsedTorrent&quot;].toBool()}</a>
<a name="ln1303">    };</a>
<a name="ln1304">    b_Started = b_Running = false;</a>
<a name="ln1305">    b_Finished = true;</a>
<a name="ln1306">    b_Canceled = false;</a>
<a name="ln1307"> </a>
<a name="ln1308">    if(b_CancelRequested) {</a>
<a name="ln1309">        QFile::remove(info[&quot;AbsolutePath&quot;].toString());</a>
<a name="ln1310"> </a>
<a name="ln1311">        b_CancelRequested = false;</a>
<a name="ln1312">        b_Canceled = true;</a>
<a name="ln1313">        emit canceled(n_CurrentAction);</a>
<a name="ln1314">        return;</a>
<a name="ln1315">    }</a>
<a name="ln1316"> </a>
<a name="ln1317">    (m_Ui-&gt;updateSpeedLbl)-&gt;setText(QString::fromUtf8(&quot;Finalizing Update... &quot;));</a>
<a name="ln1318"> </a>
<a name="ln1319">    bool execute = false;</a>
<a name="ln1320">    bool show = n_GuiFlag &amp; GuiFlag::ShowFinishedDialog;</a>
<a name="ln1321"> </a>
<a name="ln1322">    if(show) {</a>
<a name="ln1323">        auto curinfo = QFileInfo(oldVersionPath);</a>
<a name="ln1324">        QString currentAppImageName = curinfo.fileName();</a>
<a name="ln1325">        QString currentAppImageAbsPath = curinfo.absolutePath();</a>
<a name="ln1326"> </a>
<a name="ln1327">        QMessageBox box(m_UpdaterDialog.data());</a>
<a name="ln1328">        box.setWindowTitle(QString::fromUtf8(&quot;Update Completed&quot;));</a>
<a name="ln1329">        box.setIcon(QMessageBox::Information);</a>
<a name="ln1330">        box.setDetailedText(</a>
<a name="ln1331">            QString::fromUtf8(&quot;Old version is at: &quot;) +</a>
<a name="ln1332">            currentAppImageAbsPath + QString::fromUtf8(&quot;/&quot;) + currentAppImageName +</a>
<a name="ln1333">            QString::fromUtf8(&quot;\n\n&quot;) +</a>
<a name="ln1334">            QString::fromUtf8(&quot;New version is saved at: &quot;) +</a>
<a name="ln1335">            result[&quot;NewVersionPath&quot;].toString());</a>
<a name="ln1336">        box.setText(QString::fromUtf8(&quot;Update completed successfully for &lt;b&gt;&quot;) +</a>
<a name="ln1337">                    (m_ApplicationName.isEmpty() ? currentAppImageName : m_ApplicationName) +</a>
<a name="ln1338">                    QString::fromUtf8(&quot;&lt;/b&gt;, do you want to launch the new version? View details for more information.&quot;));</a>
<a name="ln1339">        box.addButton(QMessageBox::Yes);</a>
<a name="ln1340">        box.addButton(QMessageBox::No);</a>
<a name="ln1341">        execute = (box.exec() == QMessageBox::Yes);</a>
<a name="ln1342">    }</a>
<a name="ln1343"> </a>
<a name="ln1344">    if(execute) {</a>
<a name="ln1345">        QFileInfo info(result[&quot;NewVersionPath&quot;].toString());</a>
<a name="ln1346">        if(!info.isExecutable()) {</a>
<a name="ln1347">            {</a>
<a name="ln1348">                QFile file(result[&quot;NewVersionPath&quot;].toString());</a>
<a name="ln1349">                file.setPermissions(QFileDevice::ExeUser |</a>
<a name="ln1350">                                    QFileDevice::ExeOther|</a>
<a name="ln1351">                                    QFileDevice::ExeGroup|</a>
<a name="ln1352">                                    info.permissions());</a>
<a name="ln1353">            }</a>
<a name="ln1354">        }</a>
<a name="ln1355"> </a>
<a name="ln1356"> </a>
<a name="ln1357">        //// The delay is set to 5 seconds</a>
<a name="ln1358">        QProcess::startDetached(&quot;sh&quot;,</a>
<a name="ln1359">                                QStringList()</a>
<a name="ln1360">                                &lt;&lt; &quot;-c&quot;</a>
<a name="ln1361">                                &lt;&lt; (</a>
<a name="ln1362">                                    QString::fromUtf8(&quot;sleep &quot;) +</a>
<a name="ln1363">                                    QString::number(5) +</a>
<a name="ln1364">                                    QString::fromUtf8(&quot;; &quot;) +</a>
<a name="ln1365">                                    result[&quot;NewVersionPath&quot;].toString()</a>
<a name="ln1366">                                ));</a>
<a name="ln1367">        m_UpdaterDialog-&gt;hide();</a>
<a name="ln1368">        emit quit();</a>
<a name="ln1369">    }</a>
<a name="ln1370">    m_UpdaterDialog-&gt;hide();</a>
<a name="ln1371">    emit finished(result, n_CurrentAction);</a>
<a name="ln1372">    return;</a>
<a name="ln1373">}</a>
<a name="ln1374">#endif // NOT NO_GUI</a>
<a name="ln1375"> </a>
<a name="ln1376">//// Static Methods</a>
<a name="ln1377">QString QAppImageUpdatePrivate::errorCodeToString(short errorCode) {</a>
<a name="ln1378">    QString ret = &quot;QAppImageUpdate::Error::&quot;;</a>
<a name="ln1379">    switch(errorCode) {</a>
<a name="ln1380">    case QAppImageUpdateEnums::Error::NoAppimagePathGiven:</a>
<a name="ln1381">        ret += &quot;NoAppImagePathGiven&quot;;</a>
<a name="ln1382">        break;</a>
<a name="ln1383">    case QAppImageUpdateEnums::Error::AppimageNotReadable:</a>
<a name="ln1384">        ret += &quot;AppImageNotReadable&quot;;</a>
<a name="ln1385">        break;</a>
<a name="ln1386">    case QAppImageUpdateEnums::Error::NoReadPermission:</a>
<a name="ln1387">        ret += &quot;NoReadPermission&quot;;</a>
<a name="ln1388">        break;</a>
<a name="ln1389">    case QAppImageUpdateEnums::Error::AppimageNotFound:</a>
<a name="ln1390">        ret += &quot;AppimageNotFound&quot;;</a>
<a name="ln1391">        break;</a>
<a name="ln1392">    case QAppImageUpdateEnums::Error::CannotOpenAppimage:</a>
<a name="ln1393">        ret += &quot;CannnotOpenAppimage&quot;;</a>
<a name="ln1394">        break;</a>
<a name="ln1395">    case QAppImageUpdateEnums::Error::EmptyUpdateInformation:</a>
<a name="ln1396">        ret += &quot;EmptyUpdateInformation&quot;;</a>
<a name="ln1397">        break;</a>
<a name="ln1398">    case QAppImageUpdateEnums::Error::InvalidAppimageType:</a>
<a name="ln1399">        ret += &quot;InvalidAppimageType&quot;;</a>
<a name="ln1400">        break;</a>
<a name="ln1401">    case QAppImageUpdateEnums::Error::InvalidMagicBytes:</a>
<a name="ln1402">        ret += &quot;InvalidMagicBytes&quot;;</a>
<a name="ln1403">        break;</a>
<a name="ln1404">    case QAppImageUpdateEnums::Error::InvalidUpdateInformation:</a>
<a name="ln1405">        ret += &quot;InvalidUpdateInformation&quot;;</a>
<a name="ln1406">        break;</a>
<a name="ln1407">    case QAppImageUpdateEnums::Error::NotEnoughMemory:</a>
<a name="ln1408">        ret += &quot;NotEnoughMemory&quot;;</a>
<a name="ln1409">        break;</a>
<a name="ln1410">    case QAppImageUpdateEnums::Error::SectionHeaderNotFound:</a>
<a name="ln1411">        ret += &quot;SectionHeaderNotFound&quot;;</a>
<a name="ln1412">        break;</a>
<a name="ln1413">    case QAppImageUpdateEnums::Error::UnsupportedElfFormat:</a>
<a name="ln1414">        ret += &quot;UnsupportedElfFormat&quot;;</a>
<a name="ln1415">        break;</a>
<a name="ln1416">    case QAppImageUpdateEnums::Error::UnsupportedTransport:</a>
<a name="ln1417">        ret += &quot;UnsupportedTransport&quot;;</a>
<a name="ln1418">        break;</a>
<a name="ln1419">    case QAppImageUpdateEnums::Error::UnknownNetworkError:</a>
<a name="ln1420">        ret += &quot;UnknownNetworkError&quot;;</a>
<a name="ln1421">        break;</a>
<a name="ln1422">    case QAppImageUpdateEnums::Error::IoReadError:</a>
<a name="ln1423">        ret += &quot;IoReadError&quot;;</a>
<a name="ln1424">        break;</a>
<a name="ln1425">    case QAppImageUpdateEnums::Error::ErrorResponseCode:</a>
<a name="ln1426">        ret += &quot;ErrorResponseCode&quot;;</a>
<a name="ln1427">        break;</a>
<a name="ln1428">    case QAppImageUpdateEnums::Error::GithubApiRateLimitReached:</a>
<a name="ln1429">        ret += &quot;GithubApiRateLimitReached&quot;;</a>
<a name="ln1430">        break;</a>
<a name="ln1431">    case QAppImageUpdateEnums::Error::NoMarkerFoundInControlFile:</a>
<a name="ln1432">        ret += &quot;NoMarkerFoundInControlFile&quot;;</a>
<a name="ln1433">        break;</a>
<a name="ln1434">    case QAppImageUpdateEnums::Error::InvalidZsyncHeadersNumber:</a>
<a name="ln1435">        ret += &quot;InvalidZsyncHeadersNumber&quot;;</a>
<a name="ln1436">        break;</a>
<a name="ln1437">    case QAppImageUpdateEnums::Error::InvalidZsyncMakeVersion:</a>
<a name="ln1438">        ret += &quot;InvalidZsyncMakeVersion&quot;;</a>
<a name="ln1439">        break;</a>
<a name="ln1440">    case QAppImageUpdateEnums::Error::InvalidZsyncTargetFilename:</a>
<a name="ln1441">        ret += &quot;InvalidZsyncTargetFilename&quot;;</a>
<a name="ln1442">        break;</a>
<a name="ln1443">    case QAppImageUpdateEnums::Error::InvalidZsyncMtime:</a>
<a name="ln1444">        ret += &quot;InvalidZsyncMtime&quot;;</a>
<a name="ln1445">        break;</a>
<a name="ln1446">    case QAppImageUpdateEnums::Error::InvalidZsyncBlocksize:</a>
<a name="ln1447">        ret += &quot;InvalidZsyncBlocksize&quot;;</a>
<a name="ln1448">        break;</a>
<a name="ln1449">    case QAppImageUpdateEnums::Error::InvalidTargetFileLength:</a>
<a name="ln1450">        ret += &quot;InvalidTargetFileLength&quot;;</a>
<a name="ln1451">        break;</a>
<a name="ln1452">    case QAppImageUpdateEnums::Error::InvalidHashLengthLine:</a>
<a name="ln1453">        ret += &quot;InvalidHashLengthLine&quot;;</a>
<a name="ln1454">        break;</a>
<a name="ln1455">    case QAppImageUpdateEnums::Error::InvalidHashLengths:</a>
<a name="ln1456">        ret += &quot;InvalidHashLengths&quot;;</a>
<a name="ln1457">        break;</a>
<a name="ln1458">    case QAppImageUpdateEnums::Error::InvalidTargetFileUrl:</a>
<a name="ln1459">        ret += &quot;InvalidTargetFileUrl&quot;;</a>
<a name="ln1460">        break;</a>
<a name="ln1461">    case QAppImageUpdateEnums::Error::InvalidTargetFileSha1:</a>
<a name="ln1462">        ret += &quot;InvalidTargetFileSha1&quot;;</a>
<a name="ln1463">        break;</a>
<a name="ln1464">    case QAppImageUpdateEnums::Error::ConnectionRefusedError:</a>
<a name="ln1465">        ret += &quot;ConnectionRefusedError&quot;;</a>
<a name="ln1466">        break;</a>
<a name="ln1467">    case QAppImageUpdateEnums::Error::RemoteHostClosedError:</a>
<a name="ln1468">        ret += &quot;RemoteHostClosedError&quot;;</a>
<a name="ln1469">        break;</a>
<a name="ln1470">    case QAppImageUpdateEnums::Error::HostNotFoundError:</a>
<a name="ln1471">        ret += &quot;HostNotFoundError&quot;;</a>
<a name="ln1472">        break;</a>
<a name="ln1473">    case QAppImageUpdateEnums::Error::TimeoutError:</a>
<a name="ln1474">        ret += &quot;TimeoutError&quot;;</a>
<a name="ln1475">        break;</a>
<a name="ln1476">    case QAppImageUpdateEnums::Error::OperationCanceledError:</a>
<a name="ln1477">        ret += &quot;OperationCanceledError&quot;;</a>
<a name="ln1478">        break;</a>
<a name="ln1479">    case QAppImageUpdateEnums::Error::SslHandshakeFailedError:</a>
<a name="ln1480">        ret += &quot;SslHandshakeFailedError&quot;;</a>
<a name="ln1481">        break;</a>
<a name="ln1482">    case QAppImageUpdateEnums::Error::TemporaryNetworkFailureError:</a>
<a name="ln1483">        ret += &quot;TemporaryNetworkFailureError&quot;;</a>
<a name="ln1484">        break;</a>
<a name="ln1485">    case QAppImageUpdateEnums::Error::NetworkSessionFailedError:</a>
<a name="ln1486">        ret += &quot;NetworkSessionFailedError&quot;;</a>
<a name="ln1487">        break;</a>
<a name="ln1488">    case QAppImageUpdateEnums::Error::BackgroundRequestNotAllowedError:</a>
<a name="ln1489">        ret += &quot;BackgroundRequestNotAllowedError&quot;;</a>
<a name="ln1490">        break;</a>
<a name="ln1491">    case QAppImageUpdateEnums::Error::TooManyRedirectsError:</a>
<a name="ln1492">        ret += &quot;TooManyRedirectsError&quot;;</a>
<a name="ln1493">        break;</a>
<a name="ln1494">    case QAppImageUpdateEnums::Error::InsecureRedirectError:</a>
<a name="ln1495">        ret += &quot;InsecureRedirectError&quot;;</a>
<a name="ln1496">        break;</a>
<a name="ln1497">    case QAppImageUpdateEnums::Error::ProxyConnectionRefusedError:</a>
<a name="ln1498">        ret += &quot;ProxyConnectionRefusedError&quot;;</a>
<a name="ln1499">        break;</a>
<a name="ln1500">    case QAppImageUpdateEnums::Error::ProxyConnectionClosedError:</a>
<a name="ln1501">        ret += &quot;ProxyConnectionClosedError&quot;;</a>
<a name="ln1502">        break;</a>
<a name="ln1503">    case QAppImageUpdateEnums::Error::ProxyNotFoundError:</a>
<a name="ln1504">        ret += &quot;ProxyNotFoundError&quot;;</a>
<a name="ln1505">        break;</a>
<a name="ln1506">    case QAppImageUpdateEnums::Error::ProxyTimeoutError:</a>
<a name="ln1507">        ret += &quot;ProxyTimeoutError&quot;;</a>
<a name="ln1508">        break;</a>
<a name="ln1509">    case QAppImageUpdateEnums::Error::ProxyAuthenticationRequiredError:</a>
<a name="ln1510">        ret += &quot;ProxyAuthenticationRequiredError&quot;;</a>
<a name="ln1511">        break;</a>
<a name="ln1512">    case QAppImageUpdateEnums::Error::ContentAccessDenied:</a>
<a name="ln1513">        ret += &quot;ContentAccessDenied&quot;;</a>
<a name="ln1514">        break;</a>
<a name="ln1515">    case QAppImageUpdateEnums::Error::ContentOperationNotPermittedError:</a>
<a name="ln1516">        ret += &quot;ContentOperationNotPermittedError&quot;;</a>
<a name="ln1517">        break;</a>
<a name="ln1518">    case QAppImageUpdateEnums::Error::ContentNotFoundError:</a>
<a name="ln1519">        ret += &quot;ContentNotFoundError&quot;;</a>
<a name="ln1520">        break;</a>
<a name="ln1521">    case QAppImageUpdateEnums::Error::AuthenticationRequiredError:</a>
<a name="ln1522">        ret += &quot;AuthenticationRequiredError&quot;;</a>
<a name="ln1523">        break;</a>
<a name="ln1524">    case QAppImageUpdateEnums::Error::ContentReSendError:</a>
<a name="ln1525">        ret += &quot;ContentReSendError&quot;;</a>
<a name="ln1526">        break;</a>
<a name="ln1527">    case QAppImageUpdateEnums::Error::ContentConflictError:</a>
<a name="ln1528">        ret += &quot;ContentConflictError&quot;;</a>
<a name="ln1529">        break;</a>
<a name="ln1530">    case QAppImageUpdateEnums::Error::ContentGoneError:</a>
<a name="ln1531">        ret += &quot;ContentGoneError&quot;;</a>
<a name="ln1532">        break;</a>
<a name="ln1533">    case QAppImageUpdateEnums::Error::InternalServerError:</a>
<a name="ln1534">        ret += &quot;InternalServerError&quot;;</a>
<a name="ln1535">        break;</a>
<a name="ln1536">    case QAppImageUpdateEnums::Error::OperationNotImplementedError:</a>
<a name="ln1537">        ret += &quot;OperationNotImplementedError&quot;;</a>
<a name="ln1538">        break;</a>
<a name="ln1539">    case QAppImageUpdateEnums::Error::ServiceUnavailableError:</a>
<a name="ln1540">        ret += &quot;ServiceUnavailableError&quot;;</a>
<a name="ln1541">        break;</a>
<a name="ln1542">    case QAppImageUpdateEnums::Error::ProtocolUnknownError:</a>
<a name="ln1543">        ret += &quot;ProtocolUnknownError&quot;;</a>
<a name="ln1544">        break;</a>
<a name="ln1545">    case QAppImageUpdateEnums::Error::ProtocolInvalidOperationError:</a>
<a name="ln1546">        ret += &quot;ProtocolInvalidOperationError&quot;;</a>
<a name="ln1547">        break;</a>
<a name="ln1548">    case QAppImageUpdateEnums::Error::UnknownProxyError:</a>
<a name="ln1549">        ret += &quot;UnknownProxyError&quot;;</a>
<a name="ln1550">        break;</a>
<a name="ln1551">    case QAppImageUpdateEnums::Error::UnknownContentError:</a>
<a name="ln1552">        ret += &quot;UnknownContentError&quot;;</a>
<a name="ln1553">        break;</a>
<a name="ln1554">    case QAppImageUpdateEnums::Error::ProtocolFailure:</a>
<a name="ln1555">        ret += &quot;ProtocolFailure&quot;;</a>
<a name="ln1556">        break;</a>
<a name="ln1557">    case QAppImageUpdateEnums::Error::UnknownServerError:</a>
<a name="ln1558">        ret += &quot;UnknownServerError&quot;;</a>
<a name="ln1559">        break;</a>
<a name="ln1560">    case QAppImageUpdateEnums::Error::ZsyncControlFileNotFound:</a>
<a name="ln1561">        ret += &quot;ZsyncControlFileNotFound&quot;;</a>
<a name="ln1562">        break;</a>
<a name="ln1563">    case QAppImageUpdateEnums::Error::HashTableNotAllocated:</a>
<a name="ln1564">        ret += &quot;HashTableNotAllocated&quot;;</a>
<a name="ln1565">        break;</a>
<a name="ln1566">    case QAppImageUpdateEnums::Error::InvalidTargetFileChecksumBlocks:</a>
<a name="ln1567">        ret += &quot;InvalidTargetFileChecksumBlocks&quot;;</a>
<a name="ln1568">        break;</a>
<a name="ln1569">    case QAppImageUpdateEnums::Error::CannotConstructHashTable:</a>
<a name="ln1570">        ret += &quot;CannotConstructHashTable&quot;;</a>
<a name="ln1571">        break;</a>
<a name="ln1572">    case QAppImageUpdateEnums::Error::CannotOpenTargetFileChecksumBlocks:</a>
<a name="ln1573">        ret += &quot;CannotOpenTargetFileChecksumBlocks&quot;;</a>
<a name="ln1574">        break;</a>
<a name="ln1575">    case QAppImageUpdateEnums::Error::QbufferIoReadError:</a>
<a name="ln1576">        ret += &quot;QbufferIoReadError&quot;;</a>
<a name="ln1577">        break;</a>
<a name="ln1578">    case QAppImageUpdateEnums::Error::SourceFileNotFound:</a>
<a name="ln1579">        ret += &quot;SourceFileNotFound&quot;;</a>
<a name="ln1580">        break;</a>
<a name="ln1581">    case QAppImageUpdateEnums::Error::NoPermissionToReadSourceFile:</a>
<a name="ln1582">        ret += &quot;NoPermissionToReadSourceFile&quot;;</a>
<a name="ln1583">        break;</a>
<a name="ln1584">    case QAppImageUpdateEnums::Error::CannotOpenSourceFile:</a>
<a name="ln1585">        ret += &quot;CannotOpenSourceFile&quot;;</a>
<a name="ln1586">        break;</a>
<a name="ln1587">    case QAppImageUpdateEnums::Error::NoPermissionToReadWriteTargetFile:</a>
<a name="ln1588">        ret += &quot;NoPermissionToReadWriteTargetFile&quot;;</a>
<a name="ln1589">        break;</a>
<a name="ln1590">    case QAppImageUpdateEnums::Error::CannotOpenTargetFile:</a>
<a name="ln1591">        ret += &quot;CannotOpenTargetFile&quot;;</a>
<a name="ln1592">        break;</a>
<a name="ln1593">    case QAppImageUpdateEnums::Error::TargetFileSha1HashMismatch:</a>
<a name="ln1594">        ret += &quot;TargetFileSha1HashMismatch&quot;;</a>
<a name="ln1595">        break;</a>
<a name="ln1596">    case QAppImageUpdateEnums::Error::TorrentNotSupported:</a>
<a name="ln1597">	ret += &quot;TorrentNotSupported&quot;;</a>
<a name="ln1598">	break;</a>
<a name="ln1599">    case QAppImageUpdateEnums::Error::TorrentSeedFailed:</a>
<a name="ln1600">	ret += &quot;TorrentSeedFailed&quot;;</a>
<a name="ln1601">	break;</a>
<a name="ln1602">    case QAppImageUpdateEnums::Error::OutdatedAppImageForSeed:</a>
<a name="ln1603">	ret += &quot;OutdatedAppImageForSeed&quot;;</a>
<a name="ln1604">	break;</a>
<a name="ln1605">    case QAppImageUpdateEnums::Error::IncompleteAppImageForSeed:</a>
<a name="ln1606">	ret += &quot;IncompleteAppImageForSeed&quot;;</a>
<a name="ln1607">	break;</a>
<a name="ln1608">    case QAppImageUpdateEnums::Error::UnsupportedActionForBuild:</a>
<a name="ln1609">        ret += &quot;UnsupportedActionForBuild&quot;;</a>
<a name="ln1610">        break;</a>
<a name="ln1611">    case QAppImageUpdateEnums::Error::InvalidAction:</a>
<a name="ln1612">        ret += &quot;InvalidAction&quot;;</a>
<a name="ln1613">        break;</a>
<a name="ln1614">    default:</a>
<a name="ln1615">        ret += &quot;Unknown&quot;;</a>
<a name="ln1616">        break;</a>
<a name="ln1617">    }</a>
<a name="ln1618">    return ret;</a>
<a name="ln1619">}</a>
<a name="ln1620"> </a>
<a name="ln1621">QString QAppImageUpdatePrivate::errorCodeToDescriptionString(short errorCode) {</a>
<a name="ln1622">    QString errorString;</a>
<a name="ln1623">    switch(errorCode) {</a>
<a name="ln1624">    case QAppImageUpdateEnums::Error::ConnectionRefusedError:</a>
<a name="ln1625">        errorString = QString::fromUtf8(&quot;The update server is not accepting requests.&quot;);</a>
<a name="ln1626">        break;</a>
<a name="ln1627">    case QAppImageUpdateEnums::Error::RemoteHostClosedError:</a>
<a name="ln1628">        errorString = QString::fromUtf8(&quot;The remote server closed the connection prematurely, &quot;);</a>
<a name="ln1629">        errorString += QString::fromUtf8(&quot;before the entire reply was received and processed.&quot;);</a>
<a name="ln1630">        break;</a>
<a name="ln1631">    case QAppImageUpdateEnums::Error::HostNotFoundError:</a>
<a name="ln1632">        errorString = QString::fromUtf8(&quot;The remote host name was not found (invalid hostname).&quot;);</a>
<a name="ln1633">        break;</a>
<a name="ln1634">    case QAppImageUpdateEnums::Error::TimeoutError:</a>
<a name="ln1635">        errorString = QString::fromUtf8(&quot;The connection to the remote server timed out.&quot;);</a>
<a name="ln1636">        break;</a>
<a name="ln1637">    case QAppImageUpdateEnums::Error::SslHandshakeFailedError:</a>
<a name="ln1638">        errorString = QString::fromUtf8(&quot;The SSL/TLS handshake failed and the encrypted channel &quot;);</a>
<a name="ln1639">        errorString += QString::fromUtf8(&quot;could not be established.&quot;);</a>
<a name="ln1640">        break;</a>
<a name="ln1641">    case QAppImageUpdateEnums::Error::TemporaryNetworkFailureError:</a>
<a name="ln1642">        errorString = QString::fromUtf8(&quot;The connection to the network was broken.&quot;);</a>
<a name="ln1643">        break;</a>
<a name="ln1644">    case QAppImageUpdateEnums::Error::NetworkSessionFailedError:</a>
<a name="ln1645">        errorString = QString::fromUtf8(&quot;The connection to the network was broken &quot;);</a>
<a name="ln1646">        errorString += QString::fromUtf8(&quot;or could not be initiated.&quot;);</a>
<a name="ln1647">        break;</a>
<a name="ln1648">    case QAppImageUpdateEnums::Error::BackgroundRequestNotAllowedError:</a>
<a name="ln1649">        errorString = QString::fromUtf8(&quot;The background request is not currently allowed due to platform policy.&quot;);</a>
<a name="ln1650">        break;</a>
<a name="ln1651">    case QAppImageUpdateEnums::Error::TooManyRedirectsError:</a>
<a name="ln1652">        errorString = QString::fromUtf8(&quot;While following redirects, the maximum limit was reached.&quot;);</a>
<a name="ln1653">        break;</a>
<a name="ln1654">    case QAppImageUpdateEnums::Error::InsecureRedirectError:</a>
<a name="ln1655">        errorString = QString::fromUtf8(&quot;While following redirects, there was a redirect &quot;);</a>
<a name="ln1656">        errorString += QString::fromUtf8(&quot;from a encrypted protocol (https) to an unencrypted one (http).&quot;);</a>
<a name="ln1657">        break;</a>
<a name="ln1658">    case QAppImageUpdateEnums::Error::ContentAccessDenied:</a>
<a name="ln1659">        errorString = QString::fromUtf8(&quot;The access to the remote content was denied (HTTP error 403).&quot;);</a>
<a name="ln1660">        break;</a>
<a name="ln1661">    case QAppImageUpdateEnums::Error::ContentOperationNotPermittedError:</a>
<a name="ln1662">        errorString = QString::fromUtf8(&quot;The operation requested on the remote content is not permitted.&quot;);</a>
<a name="ln1663">        break;</a>
<a name="ln1664">    case QAppImageUpdateEnums::Error::ContentNotFoundError:</a>
<a name="ln1665">        errorString = QString::fromUtf8(&quot;The remote content was not found at the server (HTTP error 404)&quot;);</a>
<a name="ln1666">        break;</a>
<a name="ln1667">    case QAppImageUpdateEnums::Error::AuthenticationRequiredError:</a>
<a name="ln1668">        errorString = QString::fromUtf8(&quot;The remote server requires authentication to serve the content, &quot;);</a>
<a name="ln1669">        errorString += QString::fromUtf8(&quot;but the credentials provided were not accepted or given.&quot;);</a>
<a name="ln1670">        break;</a>
<a name="ln1671">    case QAppImageUpdateEnums::Error::ContentConflictError:</a>
<a name="ln1672">        errorString = QString::fromUtf8(&quot;The request could not be completed due to a conflict with the &quot;);</a>
<a name="ln1673">        errorString += QString::fromUtf8(&quot;current state of the resource.&quot;);</a>
<a name="ln1674">        break;</a>
<a name="ln1675">    case QAppImageUpdateEnums::Error::ContentGoneError:</a>
<a name="ln1676">        errorString = QString::fromUtf8(&quot;The requested resource is no longer available at the server.&quot;);</a>
<a name="ln1677">        break;</a>
<a name="ln1678">    case QAppImageUpdateEnums::Error::InternalServerError:</a>
<a name="ln1679">        errorString = QString::fromUtf8(&quot;The server encountered an unexpected condition which prevented &quot;);</a>
<a name="ln1680">        errorString += QString::fromUtf8(&quot;it from fulfilling the request.&quot;);</a>
<a name="ln1681">        break;</a>
<a name="ln1682">    case QAppImageUpdateEnums::Error::OperationNotImplementedError:</a>
<a name="ln1683">        errorString = QString::fromUtf8(&quot;The server does not support the functionality required to fulfill the request.&quot;);</a>
<a name="ln1684">        break;</a>
<a name="ln1685">    case QAppImageUpdateEnums::Error::ServiceUnavailableError:</a>
<a name="ln1686">        errorString = QString::fromUtf8(&quot;The server is unable to handle the request at this time.&quot;);</a>
<a name="ln1687">        break;</a>
<a name="ln1688">    case QAppImageUpdateEnums::Error::ProtocolUnknownError:</a>
<a name="ln1689">        errorString = QString::fromUtf8(&quot;The Network Access API cannot honor the request because the protocol&quot;);</a>
<a name="ln1690">        errorString += QString::fromUtf8(&quot; is not known.&quot;);</a>
<a name="ln1691">        break;</a>
<a name="ln1692">    case QAppImageUpdateEnums::Error::ProtocolInvalidOperationError:</a>
<a name="ln1693">        errorString = QString::fromUtf8(&quot;The requested operation is invalid for this protocol.&quot;);</a>
<a name="ln1694">        break;</a>
<a name="ln1695">    case QAppImageUpdateEnums::Error::UnknownNetworkError:</a>
<a name="ln1696">        errorString = QString::fromUtf8(&quot;An unknown network-related error was detected.&quot;);</a>
<a name="ln1697">        break;</a>
<a name="ln1698">    case QAppImageUpdateEnums::Error::UnknownContentError:</a>
<a name="ln1699">        errorString = QString::fromUtf8(&quot;An unknown error related to the remote content was detected.&quot;);</a>
<a name="ln1700">        break;</a>
<a name="ln1701">    case QAppImageUpdateEnums::Error::ProtocolFailure:</a>
<a name="ln1702">        errorString = QString::fromUtf8(&quot;A breakdown in protocol was detected &quot;);</a>
<a name="ln1703">        errorString += QString::fromUtf8(&quot;(parsing error, invalid or unexpected responses, etc.)&quot;);</a>
<a name="ln1704">        break;</a>
<a name="ln1705">    case QAppImageUpdateEnums::Error::UnknownServerError:</a>
<a name="ln1706">        errorString = QString::fromUtf8(&quot;An unknown error related to the server response was detected.&quot;);</a>
<a name="ln1707">        break;</a>
<a name="ln1708">    case QAppImageUpdateEnums::Error::NoAppimagePathGiven:</a>
<a name="ln1709">        errorString = QString::fromUtf8(&quot;No AppImage given.&quot;);</a>
<a name="ln1710">        break;</a>
<a name="ln1711">    case QAppImageUpdateEnums::Error::AppimageNotReadable:</a>
<a name="ln1712">        errorString = QString::fromUtf8(&quot;The AppImage is not readable.&quot;);</a>
<a name="ln1713">        break;</a>
<a name="ln1714">    case QAppImageUpdateEnums::Error::NoReadPermission:</a>
<a name="ln1715">        errorString = QString::fromUtf8(&quot;You don't have the permission to read the AppImage.&quot;);</a>
<a name="ln1716">        break;</a>
<a name="ln1717">    case QAppImageUpdateEnums::Error::AppimageNotFound:</a>
<a name="ln1718">        errorString = QString::fromUtf8(&quot;The AppImage does not exist.&quot;);</a>
<a name="ln1719">        break;</a>
<a name="ln1720">    case QAppImageUpdateEnums::Error::CannotOpenAppimage:</a>
<a name="ln1721">        errorString = QString::fromUtf8(&quot;The AppImage cannot be opened.&quot;);</a>
<a name="ln1722">        break;</a>
<a name="ln1723">    case QAppImageUpdateEnums::Error::EmptyUpdateInformation:</a>
<a name="ln1724">        errorString = QString::fromUtf8(&quot;The AppImage does not include any update information.&quot;);</a>
<a name="ln1725">        break;</a>
<a name="ln1726">    case QAppImageUpdateEnums::Error::InvalidAppimageType:</a>
<a name="ln1727">        errorString = QString::fromUtf8(&quot;The AppImage has an unknown type.&quot;);</a>
<a name="ln1728">        break;</a>
<a name="ln1729">    case QAppImageUpdateEnums::Error::InvalidMagicBytes:</a>
<a name="ln1730">        errorString = QString::fromUtf8(&quot;The AppImage is not valid.&quot;);</a>
<a name="ln1731">        break;</a>
<a name="ln1732">    case QAppImageUpdateEnums::Error::InvalidUpdateInformation:</a>
<a name="ln1733">        errorString = QString::fromUtf8(&quot;The AppImage has invalid update information.&quot;);</a>
<a name="ln1734">        break;</a>
<a name="ln1735">    case QAppImageUpdateEnums::Error::NotEnoughMemory:</a>
<a name="ln1736">        errorString = QString::fromUtf8(&quot;Not enough memory.&quot;);</a>
<a name="ln1737">        break;</a>
<a name="ln1738">    case QAppImageUpdateEnums::Error::SectionHeaderNotFound:</a>
<a name="ln1739">        errorString = QString::fromUtf8(&quot;The AppImage does not contain update information &quot;);</a>
<a name="ln1740">        errorString += QString::fromUtf8(&quot;at a valid section header.&quot;);</a>
<a name="ln1741">        break;</a>
<a name="ln1742">    case QAppImageUpdateEnums::Error::UnsupportedElfFormat:</a>
<a name="ln1743">        errorString = QString::fromUtf8(&quot;The AppImage is not in supported ELF format.&quot;);</a>
<a name="ln1744">        break;</a>
<a name="ln1745">    case QAppImageUpdateEnums::Error::UnsupportedTransport:</a>
<a name="ln1746">        errorString = QString::fromUtf8(&quot;The AppImage specifies an unsupported update transport.&quot;);</a>
<a name="ln1747">        break;</a>
<a name="ln1748">    case QAppImageUpdateEnums::Error::IoReadError:</a>
<a name="ln1749">        errorString = QString::fromUtf8(&quot;Unknown IO read error.&quot;);</a>
<a name="ln1750">        break;</a>
<a name="ln1751">    case QAppImageUpdateEnums::Error::GithubApiRateLimitReached:</a>
<a name="ln1752">        errorString = QString::fromUtf8(&quot;GitHub API rate limit reached, please try again later.&quot;);</a>
<a name="ln1753">        break;</a>
<a name="ln1754">    case QAppImageUpdateEnums::Error::ErrorResponseCode:</a>
<a name="ln1755">        errorString = QString::fromUtf8(&quot;Bad response from the server, please try again later.&quot;);</a>
<a name="ln1756">        break;</a>
<a name="ln1757">    case QAppImageUpdateEnums::Error::NoMarkerFoundInControlFile:</a>
<a name="ln1758">    case QAppImageUpdateEnums::Error::InvalidZsyncHeadersNumber:</a>
<a name="ln1759">    case QAppImageUpdateEnums::Error::InvalidZsyncMakeVersion:</a>
<a name="ln1760">    case QAppImageUpdateEnums::Error::InvalidZsyncTargetFilename:</a>
<a name="ln1761">    case QAppImageUpdateEnums::Error::InvalidZsyncMtime:</a>
<a name="ln1762">    case QAppImageUpdateEnums::Error::InvalidZsyncBlocksize:</a>
<a name="ln1763">    case QAppImageUpdateEnums::Error::InvalidTargetFileLength:</a>
<a name="ln1764">    case QAppImageUpdateEnums::Error::InvalidHashLengthLine:</a>
<a name="ln1765">    case QAppImageUpdateEnums::Error::InvalidHashLengths:</a>
<a name="ln1766">    case QAppImageUpdateEnums::Error::InvalidTargetFileUrl:</a>
<a name="ln1767">    case QAppImageUpdateEnums::Error::InvalidTargetFileSha1:</a>
<a name="ln1768">    case QAppImageUpdateEnums::Error::HashTableNotAllocated:</a>
<a name="ln1769">    case QAppImageUpdateEnums::Error::InvalidTargetFileChecksumBlocks:</a>
<a name="ln1770">    case QAppImageUpdateEnums::Error::CannotOpenTargetFileChecksumBlocks:</a>
<a name="ln1771">    case QAppImageUpdateEnums::Error::CannotConstructHashTable:</a>
<a name="ln1772">    case QAppImageUpdateEnums::Error::QbufferIoReadError:</a>
<a name="ln1773">        errorString = QString::fromUtf8(&quot;Invalid zsync meta file.&quot;);</a>
<a name="ln1774">        break;</a>
<a name="ln1775">    case QAppImageUpdateEnums::Error::ZsyncControlFileNotFound:</a>
<a name="ln1776">        errorString = QString::fromUtf8(&quot;The zsync control file was not found in the specified location.&quot;);</a>
<a name="ln1777">        break;</a>
<a name="ln1778">    case QAppImageUpdateEnums::Error::SourceFileNotFound:</a>
<a name="ln1779">        errorString = QString::fromUtf8(&quot;The current AppImage could not be found, maybe it was deleted while updating?&quot;);</a>
<a name="ln1780">        break;</a>
<a name="ln1781">    case QAppImageUpdateEnums::Error::NoPermissionToReadSourceFile:</a>
<a name="ln1782">        errorString = QString::fromUtf8(&quot;You don't have the permission to read the current AppImage.&quot;);</a>
<a name="ln1783">        break;</a>
<a name="ln1784">    case QAppImageUpdateEnums::Error::CannotOpenSourceFile:</a>
<a name="ln1785">        errorString = QString::fromUtf8(&quot;The current AppImage cannot be opened.&quot;);</a>
<a name="ln1786">        break;</a>
<a name="ln1787">    case QAppImageUpdateEnums::Error::NoPermissionToReadWriteTargetFile:</a>
<a name="ln1788">        errorString = QString::fromUtf8(&quot;You have no write or read permissions for the new version.&quot;);</a>
<a name="ln1789">        break;</a>
<a name="ln1790">    case QAppImageUpdateEnums::Error::CannotOpenTargetFile:</a>
<a name="ln1791">        errorString = QString::fromUtf8(&quot;The new version cannot be opened to write or read.&quot;);</a>
<a name="ln1792">        break;</a>
<a name="ln1793">    case QAppImageUpdateEnums::Error::TargetFileSha1HashMismatch:</a>
<a name="ln1794">        errorString = QString::fromUtf8(&quot;The newly constructed AppImage failed the integrity check, please try again.&quot;);</a>
<a name="ln1795">        break;</a>
<a name="ln1796">    case QAppImageUpdateEnums::Error::TorrentNotSupported:</a>
<a name="ln1797">	errorString = QString::fromUtf8(&quot;The AppImage author does not support decentralized update.&quot;);</a>
<a name="ln1798">	break;</a>
<a name="ln1799">    case QAppImageUpdateEnums::Error::TorrentSeedFailed:</a>
<a name="ln1800">	errorString = QString::fromUtf8(&quot;The AppImage cannot be seeded.&quot;);</a>
<a name="ln1801">	break;</a>
<a name="ln1802">    case QAppImageUpdateEnums::Error::OutdatedAppImageForSeed:</a>
<a name="ln1803">	errorString = QString::fromUtf8(&quot;The AppImage is not the newest available for seeding.&quot;);</a>
<a name="ln1804">	break;</a>
<a name="ln1805">    case QAppImageUpdateEnums::Error::IncompleteAppImageForSeed:</a>
<a name="ln1806">	errorString = QString::fromUtf8(&quot;The AppImage is incomplete for seeding.&quot;);</a>
<a name="ln1807">	break;</a>
<a name="ln1808">    case QAppImageUpdateEnums::Error::UnsupportedActionForBuild:</a>
<a name="ln1809">        errorString = QString::fromUtf8(&quot;The current build of the core library does not support the requested action.&quot;);</a>
<a name="ln1810">        break;</a>
<a name="ln1811">    case QAppImageUpdateEnums::Error::InvalidAction:</a>
<a name="ln1812">        errorString = QString::fromUtf8(&quot;The requested action is invalid.&quot;);</a>
<a name="ln1813">        break;</a>
<a name="ln1814">    default:</a>
<a name="ln1815">        errorString = QString::fromUtf8(&quot;Unknown error.&quot;);</a>
<a name="ln1816">        break;</a>
<a name="ln1817">    }</a>
<a name="ln1818">    return errorString;</a>
<a name="ln1819">}</a>
<a name="ln1820"> </a>
<a name="ln1821">QString QAppImageUpdatePrivate::versionString() {</a>
<a name="ln1822">    return QString::fromUtf8(&quot;2.0.0&quot;);</a>
<a name="ln1823">}</a>

</code></pre>
<div class="balloon" rel="245"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1048/" target="_blank">V1048</a> The 'b_Running' variable was assigned the same value.</p></div>
<div class="balloon" rel="245"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1048/" target="_blank">V1048</a> The 'b_Started' variable was assigned the same value.</p></div>
<div class="balloon" rel="542"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1048/" target="_blank">V1048</a> The 'b_Canceled' variable was assigned the same value.</p></div>
<div class="balloon" rel="956"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v519/" target="_blank">V519</a> The 'b_Canceled' variable is assigned values twice successively. Perhaps this is a mistake. Check lines: 954, 956.</p></div>
<div class="balloon" rel="1079"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v519/" target="_blank">V519</a> The 'b_Canceled' variable is assigned values twice successively. Perhaps this is a mistake. Check lines: 1077, 1079.</p></div>
<div class="balloon" rel="1129"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v636/" target="_blank">V636</a> The 'bytesReceived / 1048576' expression was implicitly cast from 'long long' type to 'double' type. Consider utilizing an explicit type cast to avoid the loss of a fractional part. An example: double A = (double)(X) / Y;.</p></div>
<div class="balloon" rel="1130"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v636/" target="_blank">V636</a> The 'bytesTotal / 1048576' expression was implicitly cast from 'long long' type to 'double' type. Consider utilizing an explicit type cast to avoid the loss of a fractional part. An example: double A = (double)(X) / Y;.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
